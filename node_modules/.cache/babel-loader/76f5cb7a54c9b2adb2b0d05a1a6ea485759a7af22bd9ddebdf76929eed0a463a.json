{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\TTC\\\\OneDrive\\\\Documents\\\\GITHUB\\\\fe-readhub\\\\src\\\\pages\\\\read_book\\\\views\\\\ReadBookScreen.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { ReactReaderStyle } from 'react-reader';\nimport ePub from 'epubjs';\nimport ReaderHeader from './ReaderHeader';\nimport ReaderContent from './ReaderContent';\nimport NotePopover from './NotePopover';\nimport NotesDrawer from './NotesDrawer';\nimport SettingsDrawer from './SettingsDrawer';\nimport { Button, Select, MenuItem, TextField, DialogActions, Dialog, DialogTitle, DialogContent } from '@mui/material';\nimport axios from 'axios';\nimport { toast } from 'react-toastify';\nimport 'react-toastify/dist/ReactToastify.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst colors = ['#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9', '#BAE1FF'];\nconst themes = ['#FFFFFF', '#F5F5F5', '#121212'];\nconst fontFamilies = ['Arial', 'Times New Roman', 'Georgia', 'Verdana', 'Roboto'];\nconst defaultSettings = {\n  theme: themes[0],\n  pageView: 'double',\n  fontFamily: fontFamilies[0],\n  fontSize: 100,\n  fontWeight: 400,\n  lineHeight: 1.5,\n  zoom: 100\n};\nfunction ReadBookScreen() {\n  _s();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [loca, setLocation] = useState(location || '');\n  const {\n    bookId,\n    bookTitle\n  } = location.state || {};\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [epubUrl, setEpubUrl] = useState(null);\n  const [selections, setSelections] = useState([]);\n  const [drawerOpen, setDrawerOpen] = useState(false);\n  const [rendition, setRendition] = useState(null);\n  const [highlightColor, setHighlightColor] = useState(colors[0]);\n  const [comment, setComment] = useState('');\n  const [popoverAnchor, setPopoverAnchor] = useState(null);\n  const [selectedText, setSelectedText] = useState('');\n  const [selectedCfiRange, setSelectedCfiRange] = useState('');\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filter, setFilter] = useState('all');\n  const [editingNote, setEditingNote] = useState(null);\n  const [settingsDrawerOpen, setSettingsDrawerOpen] = useState(false);\n  const [settings, setSettings] = useState(defaultSettings);\n  const [user, setUser] = useState(null);\n  const [isNote, setIsNote] = useState(false);\n  const [hasBookmark, setHasBookmark] = useState(false);\n  const [currentLocation, setCurrentLocation] = useState(null);\n  const [readStartTime, setReadStartTime] = useState(null);\n  const [bookmarkId, setBookmarkId] = useState(null);\n  const [totalTimeSpent, setTotalTimeSpent] = useState(0);\n  const [lastReadingUpdate, setLastReadingUpdate] = useState(null);\n  const [isActive, setIsActive] = useState(true);\n  const startReadingSession = () => {\n    setReadStartTime(Date.now());\n  };\n  const updateReadingHistory = async () => {\n    const currentTime = Date.now();\n    const timeSpent = Math.floor((currentTime - lastReadingUpdate) / 1000); // Convert to seconds\n\n    // if (timeSpent < 1) return\n\n    try {\n      await axios.post('http://localhost:8080/api/v1/reading-history', {\n        userId: user.userId,\n        bookId: bookId,\n        timeSpent: timeSpent\n      }, {\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      setLastReadingUpdate(currentTime);\n    } catch (error) {\n      console.error('Error updating reading history:', error);\n    }\n  };\n  const saveBookmark = async location => {\n    if (!user || !bookId) return;\n    try {\n      console.log('location', loca);\n      await axios.post('http://localhost:8080/api/v1/bookmark', {\n        userId: user.userId,\n        bookId: bookId,\n        location: loca\n      }, {\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      setHasBookmark(true);\n      toast.success('Đã lưu đánh dấu trang');\n    } catch (error) {\n      console.error('Error saving bookmark:', error);\n      toast.error('Có lỗi xảy ra khi lưu đánh dấu trang', 'error');\n    }\n  };\n  const getUser = async () => {\n    if (!localStorage.getItem('token')) return;\n    try {\n      const response = await axios.get('http://localhost:8080/api/v1/user/profile', {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      setUser(response.data);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n  const getNotes = async () => {\n    if (!(user !== null && user !== void 0 && user.userId) || !bookId || !rendition) return;\n    try {\n      const response = await axios.get(`http://localhost:8080/api/v1/note/user/${user.userId}/book/${bookId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n\n      // Extract the data array from the response\n      const notesData = Array.isArray(response.data.data) ? response.data.data : [];\n      setSelections(notesData);\n\n      // Không cần thêm highlights ở đây vì sẽ được xử lý bởi useEffect\n    } catch (error) {\n      console.error('Error fetching notes:', error);\n      setSelections([]);\n    }\n  };\n  const handleEditNote = note => {\n    setEditingNote(note);\n    console.log('note', note);\n  };\n  const handleSaveEdit = async () => {\n    try {\n      await axios.put(`http://localhost:8080/api/v1/note`, editingNote, {\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      if (editingNote) {\n        setSelections(selections.map(s => s.cfiRange === editingNote.cfiRange ? editingNote : s));\n        setEditingNote(null);\n      }\n      setIsNote(!isNote);\n    } catch (error) {\n      console.error('Error updating note:', error);\n    }\n  };\n  const getBookmark = async () => {\n    if (!user || !bookId) return;\n    try {\n      const response = await axios.get(`http://localhost:8080/api/v1/bookmark/user/${user.userId}/book/${bookId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n      if (response.data) {\n        console.log('bookmark', response.data);\n        setHasBookmark(true);\n        setBookmarkId(response.data.data.bookmarkId);\n        console.log('bookmarkId', bookmarkId);\n        setLocation(response.data.data.location);\n      }\n    } catch (error) {\n      console.error('Error fetching bookmark:', error);\n    }\n  };\n  const handleToggleBookmark = async () => {\n    if (!user || !bookId) return;\n    if (hasBookmark && bookmarkId) {\n      try {\n        await axios.put('http://localhost:8080/api/v1/bookmark', {\n          bookmarkId: bookmarkId,\n          userId: user.userId,\n          bookId: bookId,\n          location: loca\n        }, {\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${localStorage.getItem('token')}`\n          }\n        });\n        toast.success('Đã đánh dấu trang');\n      } catch (error) {\n        toast.error('Có lỗi xảy ra khi đánh dấu trang', 'error');\n      }\n    } else {\n      await saveBookmark(currentLocation);\n    }\n  };\n  const handleError = error => {\n    console.error('Error in ReactReader:', error);\n    setError('An error occurred while loading the book. Please try again later.');\n    setLoading(false);\n  };\n  const handleToggleDrawer = () => {\n    setDrawerOpen(!drawerOpen);\n  };\n  const handleSettingsDrawerToggle = () => {\n    setSettingsDrawerOpen(!settingsDrawerOpen);\n  };\n  const applySettings = () => {\n    if (rendition) {\n      rendition.themes.default({\n        body: {\n          background: settings.theme,\n          color: settings.theme === '#121212' ? '#FFFFFF' : '#000000',\n          'font-family': settings.fontFamily,\n          'font-size': `${settings.fontSize}%`,\n          'font-weight': settings.fontWeight,\n          'line-height': settings.lineHeight,\n          transform: `scale(${settings.zoom / 100})`,\n          'transform-origin': 'top left'\n        },\n        'a, a:link, a:visited, a:hover, a:active': {\n          color: 'inherit !important',\n          '-webkit-text-fill-color': 'inherit !important',\n          'text-decoration': 'none'\n        },\n        '::selection': {\n          'background-color': 'rgba(0, 0, 255, 0.1)',\n          color: 'inherit'\n        },\n        '*': {\n          transition: 'none !important'\n        }\n      });\n      rendition.themes.select('default');\n      if (settings.pageView === 'double') {\n        rendition.spread('auto');\n      } else {\n        rendition.spread('none');\n      }\n    }\n  };\n  const updateSettings = (key, value) => {\n    setSettings(prevSettings => ({\n      ...prevSettings,\n      [key]: value\n    }));\n  };\n  const handleResetSettings = () => {\n    setSettings(defaultSettings);\n  };\n  useEffect(() => {\n    applySettings();\n  }, [settings]);\n  useEffect(() => {\n    if (user !== null && user !== void 0 && user.userId && bookId) {\n      setLastReadingUpdate(Date.now());\n      setIsActive(true);\n\n      // Update every 5 minutes if the page is active\n      const intervalId = setInterval(() => {\n        if (isActive) {\n          updateReadingHistory();\n        }\n      }, 5 * 60 * 1000);\n\n      // Clean up\n      return () => {\n        updateReadingHistory();\n        clearInterval(intervalId);\n      };\n    }\n  }, [user, bookId]);\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        setIsActive(false);\n        updateReadingHistory();\n      } else {\n        setIsActive(true);\n        setLastReadingUpdate(Date.now());\n      }\n    };\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n    };\n  }, []);\n  useEffect(() => {\n    const epubUrl = `https://www.gutenberg.org/cache/epub/${bookId}/pg${bookId}.epub`;\n    setEpubUrl(epubUrl);\n    getUser();\n  }, [bookId]);\n  useEffect(() => {\n    const handleBeforeUnload = () => {\n      updateReadingHistory();\n    };\n    window.addEventListener('beforeunload', handleBeforeUnload);\n    return () => {\n      window.removeEventListener('beforeunload', handleBeforeUnload);\n    };\n  }, []);\n  useEffect(() => {\n    getBookmark();\n  }, [user]);\n  useEffect(() => {\n    if (user && bookId) {\n      getNotes();\n    }\n  }, [user, bookId, rendition, isNote]);\n  useEffect(() => {\n    if (rendition) {\n      const handleSelection = (cfiRange, contents) => {\n        const selection = contents.window.getSelection();\n        const range = selection.getRangeAt(0);\n        const text = selection.toString().trim();\n        if (text) {\n          setSelectedText(text);\n          setSelectedCfiRange(cfiRange);\n          const rect = range.getBoundingClientRect();\n          const viewportHeight = window.innerHeight;\n          const viewportWidth = window.innerWidth;\n          setPopoverAnchor({\n            top: rect.top < viewportHeight / 2 ? rect.bottom + window.scrollY + 115 : rect.top + window.scrollY - 60,\n            left: viewportWidth / 2 + 5\n          });\n        }\n      };\n      rendition.on('selected', handleSelection);\n      rendition.themes.default({\n        '::selection': {\n          background: 'rgba(0, 0, 255, 0.1)',\n          // Light blue on selection\n          color: 'inherit'\n        },\n        'a:link': {\n          color: 'inherit !important',\n          '-webkit-text-fill-color': 'inherit !important'\n        },\n        'a:hover': {\n          color: 'inherit !important',\n          '-webkit-text-fill-color': 'inherit !important'\n        }\n      });\n      rendition.on('rendered', section => {\n        section.document.addEventListener('click', () => {\n          const highlightElements = section.document.querySelectorAll('.highlight');\n          highlightElements.forEach(el => {\n            el.style.transition = 'background-color 0.3s ease';\n          });\n        });\n      });\n      return () => {\n        rendition.off('selected', handleSelection);\n      };\n    }\n  }, [rendition]);\n  useEffect(() => {\n    if (rendition) {\n      const applyHighlights = () => {\n        // Xóa tất cả highlights hiện tại\n        rendition.annotations.remove('highlight');\n\n        // Áp dụng lại highlights cho tất cả selections\n        selections.forEach(note => {\n          rendition.annotations.add('highlight', note.cfiRange, {}, null, 'hl', {\n            fill: note.color,\n            'fill-opacity': '0.3',\n            'mix-blend-mode': 'multiply'\n          });\n        });\n      };\n\n      // Apply highlights khi component mount và khi selections thay đổi\n      applyHighlights();\n\n      // Tạo các handler functions riêng biệt\n      const handleRendered = () => {\n        applyHighlights();\n      };\n      const handleRelocated = () => {\n        applyHighlights();\n      };\n\n      // Đăng ký event listeners với các handler functions\n      rendition.on('rendered', handleRendered);\n      rendition.on('relocated', handleRelocated);\n\n      // Cleanup function\n      return () => {\n        // Xóa event listeners với cùng handler functions\n        rendition.off('rendered', handleRendered);\n        rendition.off('relocated', handleRelocated);\n      };\n    }\n  }, [rendition, selections]);\n  const handleSave = async () => {\n    if (comment && selectedCfiRange) {\n      const newNote = {\n        userId: user.userId,\n        bookId: bookId,\n        content: comment,\n        selectedText: selectedText,\n        cfiRange: selectedCfiRange,\n        color: highlightColor\n      };\n      try {\n        const response = await axios.post('http://localhost:8080/api/v1/note', newNote, {\n          headers: {\n            'Content-Type': 'application/json',\n            Authorization: `Bearer ${localStorage.getItem('token')}`\n          }\n        });\n        const createdNote = response.data;\n        setSelections(prev => [...prev, createdNote]);\n        setIsNote(!isNote);\n        setPopoverAnchor(null);\n        setComment('');\n        setSelectedText('');\n        setSelectedCfiRange('');\n      } catch (error) {\n        console.error('Error creating note:', error);\n      }\n    }\n  };\n  const handleRemoveHighlight = async (cfiRange, noteId) => {\n    try {\n      await axios.delete(`http://localhost:8080/api/v1/note/${noteId}`, {\n        headers: {\n          Authorization: `Bearer ${localStorage.getItem('token')}`\n        }\n      });\n\n      // Cập nhật state local\n      setSelections(selections.filter(s => s.cfiRange !== cfiRange));\n\n      // Xóa annotation\n      rendition.annotations.remove(cfiRange, 'highlight');\n    } catch (error) {\n      console.error('Error deleting note:', error);\n    }\n  };\n  const filteredSelections = Array.isArray(selections) ? selections.filter(selection => {\n    var _selection$selectedTe, _selection$selectedTe2, _selection$content$to, _selection$content;\n    const isTextMatch = ((_selection$selectedTe = (_selection$selectedTe2 = selection.selectedText) === null || _selection$selectedTe2 === void 0 ? void 0 : _selection$selectedTe2.toLowerCase().includes(searchTerm.toLowerCase())) !== null && _selection$selectedTe !== void 0 ? _selection$selectedTe : false) || ((_selection$content$to = (_selection$content = selection.content) === null || _selection$content === void 0 ? void 0 : _selection$content.toLowerCase().includes(searchTerm.toLowerCase())) !== null && _selection$content$to !== void 0 ? _selection$content$to : false);\n    const isColorMatch = filter === 'all' || selection.color === filter;\n    return isTextMatch && isColorMatch;\n  }).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)) // Sắp xếp theo thời gian, mới nhất trước\n  : [];\n  const readerStyles = {\n    ...ReactReaderStyle,\n    readerArea: {\n      ...ReactReaderStyle.readerArea,\n      backgroundColor: settings.theme,\n      color: settings.theme === '#121212' ? '#FFFFFF' : '#000000'\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    style: {\n      height: '100vh',\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    children: [/*#__PURE__*/_jsxDEV(ReaderHeader, {\n      title: bookTitle,\n      onBack: () => navigate(-1),\n      onToggleNotes: handleToggleDrawer,\n      onToggleSettings: handleSettingsDrawerToggle,\n      user: user,\n      onToggleBookmark: handleToggleBookmark,\n      hasBookmark: hasBookmark,\n      currentLocation: currentLocation\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 570,\n      columnNumber: 7\n    }, this), loading && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 580,\n      columnNumber: 19\n    }, this), error && /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        color: 'red'\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 581,\n      columnNumber: 17\n    }, this), /*#__PURE__*/_jsxDEV(ReaderContent, {\n      epubUrl: epubUrl,\n      location: loca,\n      onLocationChanged: loc => setLocation(loc),\n      onGetRendition: _rendition => {\n        setRendition(_rendition);\n        _rendition.on('started', () => setLoading(false));\n      },\n      onError: handleError,\n      readerStyles: readerStyles\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 582,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(NotePopover, {\n      anchorPosition: popoverAnchor,\n      open: Boolean(popoverAnchor),\n      onClose: () => setPopoverAnchor(null),\n      colors: colors,\n      highlightColor: highlightColor,\n      setHighlightColor: setHighlightColor,\n      comment: comment,\n      setComment: setComment,\n      onSave: handleSave\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 593,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(NotesDrawer, {\n      open: drawerOpen,\n      onClose: handleToggleDrawer,\n      searchTerm: searchTerm,\n      setSearchTerm: setSearchTerm,\n      filter: filter,\n      setFilter: setFilter,\n      colors: colors,\n      filteredSelections: filteredSelections,\n      rendition: rendition,\n      onRemoveHighlight: handleRemoveHighlight,\n      onEditNote: handleEditNote\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 604,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: Boolean(editingNote),\n      onClose: () => setEditingNote(null),\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"Edit Note\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 619,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          autoFocus: true,\n          margin: \"dense\",\n          label: \"Comment\",\n          fullWidth: true,\n          multiline: true,\n          rows: 4,\n          value: (editingNote === null || editingNote === void 0 ? void 0 : editingNote.content) || '',\n          onChange: e => setEditingNote({\n            ...editingNote,\n            content: e.target.value\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 621,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Select, {\n          value: (editingNote === null || editingNote === void 0 ? void 0 : editingNote.color) || colors[0],\n          onChange: e => setEditingNote({\n            ...editingNote,\n            color: e.target.value\n          }),\n          fullWidth: true,\n          style: {\n            marginTop: '10px'\n          },\n          children: colors.map((color, index) => /*#__PURE__*/_jsxDEV(MenuItem, {\n            value: color,\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                backgroundColor: color,\n                padding: '2px 10px',\n                borderRadius: '5px',\n                color: color\n              },\n              children: `ColorColorColorColorColorColori`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 642,\n              columnNumber: 17\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 641,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 633,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 620,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => setEditingNote(null),\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 656,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleSaveEdit,\n          children: \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 657,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 655,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 618,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SettingsDrawer, {\n      open: settingsDrawerOpen,\n      onClose: handleSettingsDrawerToggle,\n      settings: settings,\n      updateSettings: updateSettings,\n      themes: themes,\n      fontFamilies: fontFamilies,\n      onResetSettings: handleResetSettings\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 660,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 567,\n    columnNumber: 5\n  }, this);\n}\n_s(ReadBookScreen, \"T7qRbFzkQ+onzMiZTvS3/9M149Q=\", false, function () {\n  return [useNavigate, useLocation];\n});\n_c = ReadBookScreen;\nexport default ReadBookScreen;\nvar _c;\n$RefreshReg$(_c, \"ReadBookScreen\");","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","ReactReaderStyle","ePub","ReaderHeader","ReaderContent","NotePopover","NotesDrawer","SettingsDrawer","Button","Select","MenuItem","TextField","DialogActions","Dialog","DialogTitle","DialogContent","axios","toast","jsxDEV","_jsxDEV","colors","themes","fontFamilies","defaultSettings","theme","pageView","fontFamily","fontSize","fontWeight","lineHeight","zoom","ReadBookScreen","_s","navigate","location","loca","setLocation","bookId","bookTitle","state","error","setError","loading","setLoading","epubUrl","setEpubUrl","selections","setSelections","drawerOpen","setDrawerOpen","rendition","setRendition","highlightColor","setHighlightColor","comment","setComment","popoverAnchor","setPopoverAnchor","selectedText","setSelectedText","selectedCfiRange","setSelectedCfiRange","searchTerm","setSearchTerm","filter","setFilter","editingNote","setEditingNote","settingsDrawerOpen","setSettingsDrawerOpen","settings","setSettings","user","setUser","isNote","setIsNote","hasBookmark","setHasBookmark","currentLocation","setCurrentLocation","readStartTime","setReadStartTime","bookmarkId","setBookmarkId","totalTimeSpent","setTotalTimeSpent","lastReadingUpdate","setLastReadingUpdate","isActive","setIsActive","startReadingSession","Date","now","updateReadingHistory","currentTime","timeSpent","Math","floor","post","userId","headers","Authorization","localStorage","getItem","console","saveBookmark","log","success","getUser","response","get","data","getNotes","notesData","Array","isArray","handleEditNote","note","handleSaveEdit","put","map","s","cfiRange","getBookmark","handleToggleBookmark","handleError","handleToggleDrawer","handleSettingsDrawerToggle","applySettings","default","body","background","color","transform","transition","select","spread","updateSettings","key","value","prevSettings","handleResetSettings","intervalId","setInterval","clearInterval","handleVisibilityChange","document","hidden","addEventListener","removeEventListener","handleBeforeUnload","window","handleSelection","contents","selection","getSelection","range","getRangeAt","text","toString","trim","rect","getBoundingClientRect","viewportHeight","innerHeight","viewportWidth","innerWidth","top","bottom","scrollY","left","on","section","highlightElements","querySelectorAll","forEach","el","style","off","applyHighlights","annotations","remove","add","fill","handleRendered","handleRelocated","handleSave","newNote","content","createdNote","prev","handleRemoveHighlight","noteId","delete","filteredSelections","_selection$selectedTe","_selection$selectedTe2","_selection$content$to","_selection$content","isTextMatch","toLowerCase","includes","isColorMatch","sort","a","b","createdAt","readerStyles","readerArea","backgroundColor","className","height","display","flexDirection","children","title","onBack","onToggleNotes","onToggleSettings","onToggleBookmark","fileName","_jsxFileName","lineNumber","columnNumber","onLocationChanged","loc","onGetRendition","_rendition","onError","anchorPosition","open","Boolean","onClose","onSave","onRemoveHighlight","onEditNote","autoFocus","margin","label","fullWidth","multiline","rows","onChange","e","target","marginTop","index","padding","borderRadius","onClick","onResetSettings","_c","$RefreshReg$"],"sources":["C:/Users/TTC/OneDrive/Documents/GITHUB/fe-readhub/src/pages/read_book/views/ReadBookScreen.js"],"sourcesContent":["import React, {useEffect, useState} from 'react'\r\nimport {useLocation, useNavigate} from 'react-router-dom'\r\nimport {ReactReaderStyle} from 'react-reader'\r\nimport ePub from 'epubjs'\r\nimport ReaderHeader from './ReaderHeader'\r\nimport ReaderContent from './ReaderContent'\r\nimport NotePopover from './NotePopover'\r\nimport NotesDrawer from './NotesDrawer'\r\nimport SettingsDrawer from './SettingsDrawer'\r\nimport {\r\n  Button,\r\n  Select,\r\n  MenuItem,\r\n  TextField,\r\n  DialogActions,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n} from '@mui/material'\r\nimport axios from 'axios'\r\nimport {toast} from 'react-toastify'\r\nimport 'react-toastify/dist/ReactToastify.css'\r\n\r\nconst colors = ['#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9', '#BAE1FF']\r\nconst themes = ['#FFFFFF', '#F5F5F5', '#121212']\r\nconst fontFamilies = [\r\n  'Arial',\r\n  'Times New Roman',\r\n  'Georgia',\r\n  'Verdana',\r\n  'Roboto',\r\n]\r\nconst defaultSettings = {\r\n  theme: themes[0],\r\n  pageView: 'double',\r\n  fontFamily: fontFamilies[0],\r\n  fontSize: 100,\r\n  fontWeight: 400,\r\n  lineHeight: 1.5,\r\n  zoom: 100,\r\n}\r\n\r\nfunction ReadBookScreen() {\r\n  const navigate = useNavigate()\r\n  const location = useLocation()\r\n  const [loca, setLocation] = useState(location || '')\r\n  const {bookId, bookTitle} = location.state || {}\r\n  const [error, setError] = useState(null)\r\n  const [loading, setLoading] = useState(false)\r\n  const [epubUrl, setEpubUrl] = useState(null)\r\n  const [selections, setSelections] = useState([])\r\n  const [drawerOpen, setDrawerOpen] = useState(false)\r\n  const [rendition, setRendition] = useState(null)\r\n  const [highlightColor, setHighlightColor] = useState(colors[0])\r\n  const [comment, setComment] = useState('')\r\n  const [popoverAnchor, setPopoverAnchor] = useState(null)\r\n  const [selectedText, setSelectedText] = useState('')\r\n  const [selectedCfiRange, setSelectedCfiRange] = useState('')\r\n  const [searchTerm, setSearchTerm] = useState('')\r\n  const [filter, setFilter] = useState('all')\r\n  const [editingNote, setEditingNote] = useState(null)\r\n  const [settingsDrawerOpen, setSettingsDrawerOpen] = useState(false)\r\n  const [settings, setSettings] = useState(defaultSettings)\r\n  const [user, setUser] = useState(null)\r\n  const [isNote, setIsNote] = useState(false)\r\n  const [hasBookmark, setHasBookmark] = useState(false)\r\n  const [currentLocation, setCurrentLocation] = useState(null)\r\n  const [readStartTime, setReadStartTime] = useState(null)\r\n  const [bookmarkId, setBookmarkId] = useState(null)\r\n  const [totalTimeSpent, setTotalTimeSpent] = useState(0)\r\n  const [lastReadingUpdate, setLastReadingUpdate] = useState(null)\r\n  const [isActive, setIsActive] = useState(true)\r\n\r\n  const startReadingSession = () => {\r\n    setReadStartTime(Date.now())\r\n  }\r\n  const updateReadingHistory = async () => {\r\n    const currentTime = Date.now()\r\n    const timeSpent = Math.floor((currentTime - lastReadingUpdate) / 1000) // Convert to seconds\r\n\r\n    // if (timeSpent < 1) return\r\n\r\n    try {\r\n      await axios.post(\r\n        'http://localhost:8080/api/v1/reading-history',\r\n        {\r\n          userId: user.userId,\r\n          bookId: bookId,\r\n          timeSpent: timeSpent,\r\n        },\r\n        {\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n      setLastReadingUpdate(currentTime)\r\n    } catch (error) {\r\n      console.error('Error updating reading history:', error)\r\n    }\r\n  }\r\n\r\n  const saveBookmark = async location => {\r\n    if (!user || !bookId) return\r\n\r\n    try {\r\n      console.log('location', loca)\r\n      await axios.post(\r\n        'http://localhost:8080/api/v1/bookmark',\r\n        {\r\n          userId: user.userId,\r\n          bookId: bookId,\r\n          location: loca,\r\n        },\r\n        {\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n      setHasBookmark(true)\r\n      toast.success('Đã lưu đánh dấu trang')\r\n    } catch (error) {\r\n      console.error('Error saving bookmark:', error)\r\n      toast.error('Có lỗi xảy ra khi lưu đánh dấu trang', 'error')\r\n    }\r\n  }\r\n\r\n  const getUser = async () => {\r\n    if (!localStorage.getItem('token')) return\r\n    try {\r\n      const response = await axios.get(\r\n        'http://localhost:8080/api/v1/user/profile',\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n      setUser(response.data)\r\n    } catch (error) {\r\n      console.error(error)\r\n    }\r\n  }\r\n\r\n  const getNotes = async () => {\r\n    if (!user?.userId || !bookId || !rendition) return\r\n    try {\r\n      const response = await axios.get(\r\n        `http://localhost:8080/api/v1/note/user/${user.userId}/book/${bookId}`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n\r\n      // Extract the data array from the response\r\n      const notesData = Array.isArray(response.data.data)\r\n        ? response.data.data\r\n        : []\r\n      setSelections(notesData)\r\n\r\n      // Không cần thêm highlights ở đây vì sẽ được xử lý bởi useEffect\r\n    } catch (error) {\r\n      console.error('Error fetching notes:', error)\r\n      setSelections([])\r\n    }\r\n  }\r\n\r\n  const handleEditNote = note => {\r\n    setEditingNote(note)\r\n    console.log('note', note)\r\n  }\r\n  const handleSaveEdit = async () => {\r\n    try {\r\n      await axios.put(`http://localhost:8080/api/v1/note`, editingNote, {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n      })\r\n      if (editingNote) {\r\n        setSelections(\r\n          selections.map(s =>\r\n            s.cfiRange === editingNote.cfiRange ? editingNote : s,\r\n          ),\r\n        )\r\n        setEditingNote(null)\r\n      }\r\n      setIsNote(!isNote)\r\n    } catch (error) {\r\n      console.error('Error updating note:', error)\r\n    }\r\n  }\r\n  const getBookmark = async () => {\r\n    if (!user || !bookId) return\r\n    try {\r\n      const response = await axios.get(\r\n        `http://localhost:8080/api/v1/bookmark/user/${user.userId}/book/${bookId}`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n\r\n      if (response.data) {\r\n        console.log('bookmark', response.data)\r\n        setHasBookmark(true)\r\n        setBookmarkId(response.data.data.bookmarkId)\r\n        console.log('bookmarkId', bookmarkId)\r\n        setLocation(response.data.data.location)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching bookmark:', error)\r\n    }\r\n  }\r\n\r\n  const handleToggleBookmark = async () => {\r\n    if (!user || !bookId) return\r\n\r\n    if (hasBookmark && bookmarkId) {\r\n      try {\r\n        await axios.put(\r\n          'http://localhost:8080/api/v1/bookmark',\r\n          {\r\n            bookmarkId: bookmarkId,\r\n            userId: user.userId,\r\n            bookId: bookId,\r\n            location: loca,\r\n          },\r\n          {\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n            },\r\n          },\r\n        )\r\n        toast.success('Đã đánh dấu trang')\r\n      } catch (error) {\r\n        toast.error('Có lỗi xảy ra khi đánh dấu trang', 'error')\r\n      }\r\n    } else {\r\n      await saveBookmark(currentLocation)\r\n    }\r\n  }\r\n\r\n  const handleError = error => {\r\n    console.error('Error in ReactReader:', error)\r\n    setError(\r\n      'An error occurred while loading the book. Please try again later.',\r\n    )\r\n    setLoading(false)\r\n  }\r\n\r\n  const handleToggleDrawer = () => {\r\n    setDrawerOpen(!drawerOpen)\r\n  }\r\n  const handleSettingsDrawerToggle = () => {\r\n    setSettingsDrawerOpen(!settingsDrawerOpen)\r\n  }\r\n\r\n  const applySettings = () => {\r\n    if (rendition) {\r\n      rendition.themes.default({\r\n        body: {\r\n          background: settings.theme,\r\n          color: settings.theme === '#121212' ? '#FFFFFF' : '#000000',\r\n          'font-family': settings.fontFamily,\r\n          'font-size': `${settings.fontSize}%`,\r\n          'font-weight': settings.fontWeight,\r\n          'line-height': settings.lineHeight,\r\n          transform: `scale(${settings.zoom / 100})`,\r\n          'transform-origin': 'top left',\r\n        },\r\n        'a, a:link, a:visited, a:hover, a:active': {\r\n          color: 'inherit !important',\r\n          '-webkit-text-fill-color': 'inherit !important',\r\n          'text-decoration': 'none',\r\n        },\r\n        '::selection': {\r\n          'background-color': 'rgba(0, 0, 255, 0.1)',\r\n          color: 'inherit',\r\n        },\r\n        '*': {\r\n          transition: 'none !important',\r\n        },\r\n      })\r\n\r\n      rendition.themes.select('default')\r\n\r\n      if (settings.pageView === 'double') {\r\n        rendition.spread('auto')\r\n      } else {\r\n        rendition.spread('none')\r\n      }\r\n    }\r\n  }\r\n\r\n  const updateSettings = (key, value) => {\r\n    setSettings(prevSettings => ({\r\n      ...prevSettings,\r\n      [key]: value,\r\n    }))\r\n  }\r\n\r\n  const handleResetSettings = () => {\r\n    setSettings(defaultSettings)\r\n  }\r\n\r\n  useEffect(() => {\r\n    applySettings()\r\n  }, [settings])\r\n\r\n  useEffect(() => {\r\n    if (user?.userId && bookId) {\r\n      setLastReadingUpdate(Date.now())\r\n      setIsActive(true)\r\n\r\n      // Update every 5 minutes if the page is active\r\n      const intervalId = setInterval(() => {\r\n        if (isActive) {\r\n          updateReadingHistory()\r\n        }\r\n      }, 5 * 60 * 1000)\r\n\r\n      // Clean up\r\n      return () => {\r\n        updateReadingHistory()\r\n        clearInterval(intervalId)\r\n      }\r\n    }\r\n  }, [user, bookId])\r\n\r\n  useEffect(() => {\r\n    const handleVisibilityChange = () => {\r\n      if (document.hidden) {\r\n        setIsActive(false)\r\n        updateReadingHistory()\r\n      } else {\r\n        setIsActive(true)\r\n        setLastReadingUpdate(Date.now())\r\n      }\r\n    }\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange)\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const epubUrl = `https://www.gutenberg.org/cache/epub/${bookId}/pg${bookId}.epub`\r\n    setEpubUrl(epubUrl)\r\n    getUser()\r\n  }, [bookId])\r\n\r\n  useEffect(() => {\r\n    const handleBeforeUnload = () => {\r\n      updateReadingHistory()\r\n    }\r\n\r\n    window.addEventListener('beforeunload', handleBeforeUnload)\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    getBookmark()\r\n  }, [user])\r\n\r\n  useEffect(() => {\r\n    if (user && bookId) {\r\n      getNotes()\r\n    }\r\n  }, [user, bookId, rendition, isNote])\r\n\r\n  useEffect(() => {\r\n    if (rendition) {\r\n      const handleSelection = (cfiRange, contents) => {\r\n        const selection = contents.window.getSelection()\r\n        const range = selection.getRangeAt(0)\r\n        const text = selection.toString().trim()\r\n        if (text) {\r\n          setSelectedText(text)\r\n          setSelectedCfiRange(cfiRange)\r\n          const rect = range.getBoundingClientRect()\r\n          const viewportHeight = window.innerHeight\r\n          const viewportWidth = window.innerWidth\r\n          setPopoverAnchor({\r\n            top:\r\n              rect.top < viewportHeight / 2\r\n                ? rect.bottom + window.scrollY + 115\r\n                : rect.top + window.scrollY - 60,\r\n            left: viewportWidth / 2 + 5,\r\n          })\r\n        }\r\n      }\r\n\r\n      rendition.on('selected', handleSelection)\r\n\r\n      rendition.themes.default({\r\n        '::selection': {\r\n          background: 'rgba(0, 0, 255, 0.1)', // Light blue on selection\r\n          color: 'inherit',\r\n        },\r\n        'a:link': {\r\n          color: 'inherit !important',\r\n          '-webkit-text-fill-color': 'inherit !important',\r\n        },\r\n        'a:hover': {\r\n          color: 'inherit !important',\r\n          '-webkit-text-fill-color': 'inherit !important',\r\n        },\r\n      })\r\n\r\n      rendition.on('rendered', section => {\r\n        section.document.addEventListener('click', () => {\r\n          const highlightElements =\r\n            section.document.querySelectorAll('.highlight')\r\n          highlightElements.forEach(el => {\r\n            el.style.transition = 'background-color 0.3s ease'\r\n          })\r\n        })\r\n      })\r\n\r\n      return () => {\r\n        rendition.off('selected', handleSelection)\r\n      }\r\n    }\r\n  }, [rendition])\r\n  useEffect(() => {\r\n    if (rendition) {\r\n      const applyHighlights = () => {\r\n        // Xóa tất cả highlights hiện tại\r\n        rendition.annotations.remove('highlight')\r\n\r\n        // Áp dụng lại highlights cho tất cả selections\r\n        selections.forEach(note => {\r\n          rendition.annotations.add(\r\n            'highlight',\r\n            note.cfiRange,\r\n            {},\r\n            null,\r\n            'hl',\r\n            {\r\n              fill: note.color,\r\n              'fill-opacity': '0.3',\r\n              'mix-blend-mode': 'multiply',\r\n            },\r\n          )\r\n        })\r\n      }\r\n\r\n      // Apply highlights khi component mount và khi selections thay đổi\r\n      applyHighlights()\r\n\r\n      // Tạo các handler functions riêng biệt\r\n      const handleRendered = () => {\r\n        applyHighlights()\r\n      }\r\n\r\n      const handleRelocated = () => {\r\n        applyHighlights()\r\n      }\r\n\r\n      // Đăng ký event listeners với các handler functions\r\n      rendition.on('rendered', handleRendered)\r\n      rendition.on('relocated', handleRelocated)\r\n\r\n      // Cleanup function\r\n      return () => {\r\n        // Xóa event listeners với cùng handler functions\r\n        rendition.off('rendered', handleRendered)\r\n        rendition.off('relocated', handleRelocated)\r\n      }\r\n    }\r\n  }, [rendition, selections])\r\n\r\n  const handleSave = async () => {\r\n    if (comment && selectedCfiRange) {\r\n      const newNote = {\r\n        userId: user.userId,\r\n        bookId: bookId,\r\n        content: comment,\r\n        selectedText: selectedText,\r\n        cfiRange: selectedCfiRange,\r\n        color: highlightColor,\r\n      }\r\n\r\n      try {\r\n        const response = await axios.post(\r\n          'http://localhost:8080/api/v1/note',\r\n          newNote,\r\n          {\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n            },\r\n          },\r\n        )\r\n\r\n        const createdNote = response.data\r\n        setSelections(prev => [...prev, createdNote])\r\n        setIsNote(!isNote)\r\n\r\n        setPopoverAnchor(null)\r\n        setComment('')\r\n        setSelectedText('')\r\n        setSelectedCfiRange('')\r\n      } catch (error) {\r\n        console.error('Error creating note:', error)\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleRemoveHighlight = async (cfiRange, noteId) => {\r\n    try {\r\n      await axios.delete(`http://localhost:8080/api/v1/note/${noteId}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n      })\r\n\r\n      // Cập nhật state local\r\n      setSelections(selections.filter(s => s.cfiRange !== cfiRange))\r\n\r\n      // Xóa annotation\r\n      rendition.annotations.remove(cfiRange, 'highlight')\r\n    } catch (error) {\r\n      console.error('Error deleting note:', error)\r\n    }\r\n  }\r\n\r\n  const filteredSelections = Array.isArray(selections)\r\n    ? selections\r\n        .filter(selection => {\r\n          const isTextMatch =\r\n            (selection.selectedText\r\n              ?.toLowerCase()\r\n              .includes(searchTerm.toLowerCase()) ??\r\n              false) ||\r\n            (selection.content\r\n              ?.toLowerCase()\r\n              .includes(searchTerm.toLowerCase()) ??\r\n              false)\r\n          const isColorMatch = filter === 'all' || selection.color === filter\r\n          return isTextMatch && isColorMatch\r\n        })\r\n        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)) // Sắp xếp theo thời gian, mới nhất trước\r\n    : []\r\n\r\n  const readerStyles = {\r\n    ...ReactReaderStyle,\r\n    readerArea: {\r\n      ...ReactReaderStyle.readerArea,\r\n      backgroundColor: settings.theme,\r\n      color: settings.theme === '#121212' ? '#FFFFFF' : '#000000',\r\n    },\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className='App'\r\n      style={{height: '100vh', display: 'flex', flexDirection: 'column'}}>\r\n      <ReaderHeader\r\n        title={bookTitle}\r\n        onBack={() => navigate(-1)}\r\n        onToggleNotes={handleToggleDrawer}\r\n        onToggleSettings={handleSettingsDrawerToggle}\r\n        user={user}\r\n        onToggleBookmark={handleToggleBookmark}\r\n        hasBookmark={hasBookmark}\r\n        currentLocation={currentLocation}\r\n      />\r\n      {loading && <p>Loading...</p>}\r\n      {error && <p style={{color: 'red'}}>{error}</p>}\r\n      <ReaderContent\r\n        epubUrl={epubUrl}\r\n        location={loca}\r\n        onLocationChanged={loc => setLocation(loc)}\r\n        onGetRendition={_rendition => {\r\n          setRendition(_rendition)\r\n          _rendition.on('started', () => setLoading(false))\r\n        }}\r\n        onError={handleError}\r\n        readerStyles={readerStyles}\r\n      />\r\n      <NotePopover\r\n        anchorPosition={popoverAnchor}\r\n        open={Boolean(popoverAnchor)}\r\n        onClose={() => setPopoverAnchor(null)}\r\n        colors={colors}\r\n        highlightColor={highlightColor}\r\n        setHighlightColor={setHighlightColor}\r\n        comment={comment}\r\n        setComment={setComment}\r\n        onSave={handleSave}\r\n      />\r\n      <NotesDrawer\r\n        open={drawerOpen}\r\n        onClose={handleToggleDrawer}\r\n        searchTerm={searchTerm}\r\n        setSearchTerm={setSearchTerm}\r\n        filter={filter}\r\n        setFilter={setFilter}\r\n        colors={colors}\r\n        filteredSelections={filteredSelections}\r\n        rendition={rendition}\r\n        onRemoveHighlight={handleRemoveHighlight}\r\n        onEditNote={handleEditNote}\r\n      />\r\n\r\n      <Dialog open={Boolean(editingNote)} onClose={() => setEditingNote(null)}>\r\n        <DialogTitle>Edit Note</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            autoFocus\r\n            margin='dense'\r\n            label='Comment'\r\n            fullWidth\r\n            multiline\r\n            rows={4}\r\n            value={editingNote?.content || ''}\r\n            onChange={e =>\r\n              setEditingNote({...editingNote, content: e.target.value})\r\n            }\r\n          />\r\n          <Select\r\n            value={editingNote?.color || colors[0]}\r\n            onChange={e =>\r\n              setEditingNote({...editingNote, color: e.target.value})\r\n            }\r\n            fullWidth\r\n            style={{marginTop: '10px'}}>\r\n            {colors.map((color, index) => (\r\n              <MenuItem key={index} value={color}>\r\n                <span\r\n                  style={{\r\n                    backgroundColor: color,\r\n                    padding: '2px 10px',\r\n                    borderRadius: '5px',\r\n                    color: color,\r\n                  }}>\r\n                  {`ColorColorColorColorColorColori`}\r\n                </span>\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setEditingNote(null)}>Cancel</Button>\r\n          <Button onClick={handleSaveEdit}>Save</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <SettingsDrawer\r\n        open={settingsDrawerOpen}\r\n        onClose={handleSettingsDrawerToggle}\r\n        settings={settings}\r\n        updateSettings={updateSettings}\r\n        themes={themes}\r\n        fontFamilies={fontFamilies}\r\n        onResetSettings={handleResetSettings}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ReadBookScreen\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}