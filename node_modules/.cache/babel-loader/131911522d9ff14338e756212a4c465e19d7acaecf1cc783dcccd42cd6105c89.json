{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{ThumbsUp,MessageCircle,Share2,MoreHorizontal,Image,Send,X,Edit2,Trash2,MoreVertical}from'lucide-react';import{toast}from'react-toastify';import{DialogConfirmation}from'../../../../component/dialogs/DialogConfirmation';import{Avatar}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const ForumCommentItem=_ref=>{let{comment,stompClient,user,onCommentDeleted}=_ref;// States for reply functionality\nconst[showReplyInput,setShowReplyInput]=useState(false);const[replyContent,setReplyContent]=useState('');const[replyImage,setReplyImage]=useState(null);const[isSubmittingReply,setIsSubmittingReply]=useState(false);const replyFileInputRef=useRef(null);// States for like functionality\nconst[isLiked,setIsLiked]=useState(comment.likedByCurrentUser);const[likeCount,setLikeCount]=useState(comment.likeCount||0);// States for replies\nconst[replies,setReplies]=useState(comment.replies||[]);const[showReplies,setShowReplies]=useState(false);// States for editing comment\nconst[isEditing,setIsEditing]=useState(false);const[editContent,setEditContent]=useState(comment.content);const[editImage,setEditImage]=useState(null);const[isSubmittingEdit,setIsSubmittingEdit]=useState(false);const editFileInputRef=useRef(null);// States for editing reply\nconst[editingReplyId,setEditingReplyId]=useState(null);const[editReplyContent,setEditReplyContent]=useState('');const[editReplyImage,setEditReplyImage]=useState(null);const[isSubmittingReplyEdit,setIsSubmittingReplyEdit]=useState(false);// States for dropdowns\nconst[showCommentOptions,setShowCommentOptions]=useState(false);const[showReplyOptions,setShowReplyOptions]=useState(null);const[showDeleteCommentDialog,setShowDeleteCommentDialog]=useState(false);const[showDeleteReplyDialog,setShowDeleteReplyDialog]=useState(null);useEffect(()=>{if(stompClient){// Subscribe to like updates\nconst likeSub=stompClient.subscribe(`/topic/comment/${comment.id}/like`,message=>{const response=JSON.parse(message.body);setIsLiked(response.liked);setLikeCount(prev=>response.liked?prev+1:prev-1);});// Subscribe to reply updates\nconst replySub=stompClient.subscribe(`/topic/comment/${comment.id}/reply`,message=>{const newReply=JSON.parse(message.body);setReplies(prev=>[newReply,...prev]);});// Subscribe to reply delete\nconst replyDeleteSub=stompClient.subscribe(`/topic/comment/${comment.id}/reply/delete`,message=>{const{replyId}=JSON.parse(message.body);setReplies(prev=>prev.filter(reply=>reply.id!==replyId));toast.success('Reply deleted successfully');});// Subscribe to reply update\nconst replyUpdateSub=stompClient.subscribe(`/topic/reply/${comment.id}/update`,message=>{const updatedReply=JSON.parse(message.body);setReplies(prev=>prev.map(reply=>reply.id===updatedReply.id?updatedReply:reply));setEditingReplyId(null);});// Subscribe to comment delete\nconst commentDeleteSub=stompClient.subscribe(`/topic/comment/${comment.id}/delete`,()=>{onCommentDeleted&&onCommentDeleted(comment.id);toast.success('Comment deleted successfully');});// Subscribe to comment update\nconst commentUpdateSub=stompClient.subscribe(`/topic/comment/${comment.id}/update`,message=>{const updatedComment=JSON.parse(message.body);setEditContent(updatedComment.content);setIsEditing(false);});// Subscribe to errors\nconst errorSub=stompClient.subscribe(`/topic/errors/comment/${comment.id}`,message=>{const error=JSON.parse(message.body);toast.error(`Error: ${error.message}`);});return()=>{likeSub.unsubscribe();replySub.unsubscribe();replyDeleteSub.unsubscribe();replyUpdateSub.unsubscribe();commentDeleteSub.unsubscribe();commentUpdateSub.unsubscribe();errorSub.unsubscribe();};}},[stompClient,comment.id,onCommentDeleted]);const handleLike=()=>{if(!user){toast.error('Please login to like comments');return;}if(stompClient!==null&&stompClient!==void 0&&stompClient.connected){stompClient.send('/app/comment/like',{Authorization:`Bearer ${localStorage.getItem('token')}`},JSON.stringify({commentId:comment.id}));}};const handleDelete=()=>{if(stompClient!==null&&stompClient!==void 0&&stompClient.connected){stompClient.send('/app/comment/delete',{Authorization:`Bearer ${localStorage.getItem('token')}`},JSON.stringify({commentId:comment.id}));}};const handleEditSubmit=async()=>{if(!editContent.trim()&&!editImage)return;if(isSubmittingEdit)return;try{setIsSubmittingEdit(true);let imageUrl=comment.imageUrl;if(editImage){const formData=new FormData();formData.append('file',editImage);const response=await fetch('http://localhost:8080/api/v1/upload',{method:'POST',headers:{Authorization:`Bearer ${localStorage.getItem('token')}`},body:formData});if(response.ok){const result=await response.json();imageUrl=result.data.url;}}if(stompClient!==null&&stompClient!==void 0&&stompClient.connected){stompClient.send('/app/comment/update',{Authorization:`Bearer ${localStorage.getItem('token')}`},JSON.stringify({commentId:comment.id,content:editContent,imageUrl}));}}catch(error){console.error('Error updating comment:',error);toast.error('Failed to update comment');}finally{setIsSubmittingEdit(false);}};const handleReplyDelete=replyId=>{try{if(!(stompClient!==null&&stompClient!==void 0&&stompClient.connected)){toast.error('Connection lost. Please refresh the page.');return;}stompClient.send('/app/comment/reply/delete',{Authorization:`Bearer ${localStorage.getItem('token')}`},JSON.stringify({replyId:replyId}));setShowReplyOptions(null);}catch(error){console.error('Error deleting reply:',error);toast.error('Failed to delete reply. Please try again.');}};const handleReplyEdit=async replyId=>{if(!editReplyContent.trim()&&!editReplyImage)return;if(isSubmittingReplyEdit)return;try{var _replies$find;setIsSubmittingReplyEdit(true);let imageUrl=(_replies$find=replies.find(r=>r.id===replyId))===null||_replies$find===void 0?void 0:_replies$find.imageUrl;if(editReplyImage){const formData=new FormData();formData.append('file',editReplyImage);const response=await fetch('http://localhost:8080/api/v1/upload',{method:'POST',headers:{Authorization:`Bearer ${localStorage.getItem('token')}`},body:formData});if(response.ok){const result=await response.json();imageUrl=result.data.url;}}if(stompClient!==null&&stompClient!==void 0&&stompClient.connected){stompClient.send('/app/comment/reply/update',{Authorization:`Bearer ${localStorage.getItem('token')}`},JSON.stringify({replyId:replyId,content:editReplyContent,imageUrl}));}}catch(error){console.error('Error updating reply:',error);toast.error('Failed to update reply');}finally{setIsSubmittingReplyEdit(false);}};const handleReplyImageSelect=event=>{const file=event.target.files[0];if(file){setReplyImage(file);}};const handleSubmitReply=async()=>{if(!user){toast.error('Please login to reply');return;}if(!replyContent.trim()&&!replyImage)return;if(isSubmittingReply)return;try{setIsSubmittingReply(true);let imageUrl=null;if(replyImage){const formData=new FormData();formData.append('file',replyImage);const response=await fetch('http://localhost:8080/api/v1/upload',{method:'POST',headers:{Authorization:`Bearer ${localStorage.getItem('token')}`},body:formData});if(response.ok){const result=await response.json();imageUrl=result.data.url;}}if(stompClient!==null&&stompClient!==void 0&&stompClient.connected){stompClient.send('/app/comment/reply',{Authorization:`Bearer ${localStorage.getItem('token')}`},JSON.stringify({commentId:comment.id,content:replyContent,imageUrl}));setReplyContent('');setReplyImage(null);if(replyFileInputRef.current){replyFileInputRef.current.value='';}setShowReplyInput(false);}}catch(error){console.error('Error posting reply:',error);toast.error('Failed to post reply');}finally{setIsSubmittingReply(false);}};const canModifyComment=user&&(user.userId===comment.user.userId||user.role==='ROLE_ADMIN');const canModifyReply=reply=>user&&(user.userId===reply.user.userId||user.role==='ROLE_ADMIN');return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4\",children:[user.urlAvatar?/*#__PURE__*/_jsx(Avatar,{src:user.urlAvatar}):/*#__PURE__*/_jsx(Avatar,{children:user.username?user.username.toUpperCase().charAt(0):'U'}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-lg\",children:comment.user.username}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm\",children:new Date(comment.createdAt).toLocaleString()})]})]}),canModifyComment&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-400 hover:text-gray-600\",onClick:()=>setShowCommentOptions(!showCommentOptions),children:/*#__PURE__*/_jsx(MoreVertical,{className:\"w-6 h-6\"})}),showCommentOptions&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"py-1\",role:\"menu\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2\",onClick:()=>{setIsEditing(true);setShowCommentOptions(false);},children:[/*#__PURE__*/_jsx(Edit2,{className:\"w-4 h-4\"}),\"Edit\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 flex items-center gap-2\",onClick:()=>{setShowDeleteCommentDialog(true);setShowCommentOptions(false);},children:[/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"}),\"Delete\"]})]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pl-16\",children:[isEditing?/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:editContent,onChange:e=>setEditContent(e.target.value),className:\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",rows:\"3\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mt-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:e=>setEditImage(e.target.files[0]),ref:editFileInputRef,className:\"hidden\",id:`edit-image-${comment.id}`}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:`edit-image-${comment.id}`,className:\"cursor-pointer flex items-center gap-2 text-gray-600 hover:text-blue-600\",children:[/*#__PURE__*/_jsx(Image,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Change Image\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setIsEditing(false),className:\"px-4 py-2 text-gray-600 hover:text-gray-800\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleEditSubmit,disabled:isSubmittingEdit,className:`${isSubmittingEdit?'bg-gray-400 cursor-not-allowed':'bg-blue-600 hover:bg-blue-700'} text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2`,children:isSubmittingEdit?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Saving...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Send,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Save\"})]})})]})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-800 whitespace-pre-wrap mb-4\",children:comment.content}),comment.imageUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(\"img\",{src:comment.imageUrl,alt:\"Comment attachment\",className:\"max-w-full rounded-lg\",onError:e=>{console.error('Image load error:',e);e.target.style.display='none';}})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-6 text-gray-500\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleLike,className:`flex items-center gap-2 transition-colors ${isLiked?'text-blue-600':'hover:text-blue-600'}`,children:[/*#__PURE__*/_jsx(ThumbsUp,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:likeCount})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowReplyInput(!showReplyInput),className:\"flex items-center gap-2 hover:text-blue-600 transition-colors\",children:[/*#__PURE__*/_jsx(MessageCircle,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Reply\",replies.length>0&&` (${replies.length})`]})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"flex items-center gap-2 hover:text-blue-600 transition-colors\",children:[/*#__PURE__*/_jsx(Share2,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Share\"})]})]}),showReplyInput&&user&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4\",children:[user.urlAvatar?/*#__PURE__*/_jsx(Avatar,{src:user.urlAvatar}):/*#__PURE__*/_jsx(Avatar,{children:user.username?user.username.toUpperCase().charAt(0):'U'}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:replyContent,onChange:e=>setReplyContent(e.target.value),placeholder:\"Write a reply...\",className:\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none\",rows:\"2\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleReplyImageSelect,ref:replyFileInputRef,className:\"hidden\",id:`reply-image-${comment.id}`}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:`reply-image-${comment.id}`,className:\"cursor-pointer flex items-center gap-2 text-gray-600 hover:text-blue-600 transition-colors\",children:[/*#__PURE__*/_jsx(Image,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Add Image\"})]}),replyImage&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:replyImage.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setReplyImage(null);if(replyFileInputRef.current){replyFileInputRef.current.value='';}},className:\"text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(X,{className:\"w-4 h-4\"})})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmitReply,disabled:isSubmittingReply,className:`${isSubmittingReply?'bg-gray-400 cursor-not-allowed':'bg-blue-600 hover:bg-blue-700'} text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2`,children:isSubmittingReply?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Sending...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Send,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Reply\"})]})})]})]})]})}),replies.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowReplies(!showReplies),className:\"text-blue-600 hover:text-blue-700 mb-4\",children:[showReplies?'Hide':'Show',\" \",replies.length,\" replies\"]}),showReplies&&/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:replies.map(reply=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-4\",children:[user.urlAvatar?/*#__PURE__*/_jsx(Avatar,{src:user.urlAvatar}):/*#__PURE__*/_jsx(Avatar,{children:user.username?user.username.toUpperCase().charAt(0):'U'}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-4 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold\",children:reply.user.fullName}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:new Date(reply.createdAt).toLocaleString()})]}),canModifyReply(reply)&&/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowReplyOptions(reply.id),className:\"text-gray-400 hover:text-gray-600\",children:/*#__PURE__*/_jsx(MoreVertical,{className:\"w-5 h-5\"})}),showReplyOptions===reply.id&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"py-1\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2\",onClick:()=>{setEditingReplyId(reply.id);setEditReplyContent(reply.content);setShowReplyOptions(null);},children:[/*#__PURE__*/_jsx(Edit2,{className:\"w-4 h-4\"}),\"Edit\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 flex items-center gap-2\",onClick:()=>{setShowDeleteReplyDialog(reply.id);setShowReplyOptions(null);},children:[/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"}),\"Delete\"]})]})})]})]}),editingReplyId===reply.id?/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:editReplyContent,onChange:e=>setEditReplyContent(e.target.value),className:\"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",rows:\"2\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:e=>setEditReplyImage(e.target.files[0]),className:\"hidden\",id:`edit-reply-image-${reply.id}`}),/*#__PURE__*/_jsxs(\"label\",{htmlFor:`edit-reply-image-${reply.id}`,className:\"cursor-pointer flex items-center gap-2 text-gray-600 hover:text-blue-600\",children:[/*#__PURE__*/_jsx(Image,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:reply.imageUrl?'Change Image':'Add Image'})]}),(editReplyImage||reply.imageUrl)&&/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2\",children:editReplyImage?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:editReplyImage.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setEditReplyImage(null);},className:\"text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(X,{className:\"w-4 h-4\"})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:\"Current image\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{// Set imageUrl to null in backend\nhandleReplyEdit(reply.id,editReplyContent,null);},className:\"text-red-500 hover:text-red-700\",children:/*#__PURE__*/_jsx(X,{className:\"w-4 h-4\"})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setEditingReplyId(null);setEditReplyContent('');setEditReplyImage(null);},className:\"px-3 py-1 text-gray-600 hover:text-gray-800\",children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleReplyEdit(reply.id),disabled:isSubmittingReplyEdit,className:`${isSubmittingReplyEdit?'bg-gray-400 cursor-not-allowed':'bg-blue-600 hover:bg-blue-700'} text-white px-3 py-1 rounded-lg transition-colors flex items-center gap-2`,children:isSubmittingReplyEdit?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Saving...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Send,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Save\"})]})})]})]}),(editReplyImage||reply.imageUrl)&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:editReplyImage?/*#__PURE__*/_jsx(\"img\",{src:URL.createObjectURL(editReplyImage),alt:\"Preview\",className:\"max-w-full h-auto rounded-lg\"}):reply.imageUrl&&/*#__PURE__*/_jsx(\"img\",{src:reply.imageUrl,alt:\"Current attachment\",className:\"max-w-full h-auto rounded-lg\",onError:e=>{console.error('Image load error:',e);e.target.style.display='none';}})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-gray-800 whitespace-pre-wrap\",children:reply.content}),reply.imageUrl&&/*#__PURE__*/_jsx(\"img\",{src:reply.imageUrl,alt:\"Reply attachment\",className:\"mt-2 max-w-full rounded-lg\",onError:e=>{console.error('Image load error:',e);e.target.style.display='none';}})]})]})})]},reply.id))})]})]}),/*#__PURE__*/_jsx(DialogConfirmation,{isOpen:showDeleteCommentDialog,onClose:()=>setShowDeleteCommentDialog(false),onConfirm:handleDelete,title:\"Delete Comment\",message:\"Are you sure you want to delete this comment? This action cannot be undone.\"}),/*#__PURE__*/_jsx(DialogConfirmation,{isOpen:showDeleteReplyDialog!==null,onClose:()=>setShowDeleteReplyDialog(null),onConfirm:()=>handleReplyDelete(showDeleteReplyDialog),title:\"Delete Reply\",message:\"Are you sure you want to delete this reply? This action cannot be undone.\"})]});};export default ForumCommentItem;","map":{"version":3,"names":["React","useState","useEffect","useRef","ThumbsUp","MessageCircle","Share2","MoreHorizontal","Image","Send","X","Edit2","Trash2","MoreVertical","toast","DialogConfirmation","Avatar","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ForumCommentItem","_ref","comment","stompClient","user","onCommentDeleted","showReplyInput","setShowReplyInput","replyContent","setReplyContent","replyImage","setReplyImage","isSubmittingReply","setIsSubmittingReply","replyFileInputRef","isLiked","setIsLiked","likedByCurrentUser","likeCount","setLikeCount","replies","setReplies","showReplies","setShowReplies","isEditing","setIsEditing","editContent","setEditContent","content","editImage","setEditImage","isSubmittingEdit","setIsSubmittingEdit","editFileInputRef","editingReplyId","setEditingReplyId","editReplyContent","setEditReplyContent","editReplyImage","setEditReplyImage","isSubmittingReplyEdit","setIsSubmittingReplyEdit","showCommentOptions","setShowCommentOptions","showReplyOptions","setShowReplyOptions","showDeleteCommentDialog","setShowDeleteCommentDialog","showDeleteReplyDialog","setShowDeleteReplyDialog","likeSub","subscribe","id","message","response","JSON","parse","body","liked","prev","replySub","newReply","replyDeleteSub","replyId","filter","reply","success","replyUpdateSub","updatedReply","map","commentDeleteSub","commentUpdateSub","updatedComment","errorSub","error","unsubscribe","handleLike","connected","send","Authorization","localStorage","getItem","stringify","commentId","handleDelete","handleEditSubmit","trim","imageUrl","formData","FormData","append","fetch","method","headers","ok","result","json","data","url","console","handleReplyDelete","handleReplyEdit","_replies$find","find","r","handleReplyImageSelect","event","file","target","files","handleSubmitReply","current","value","canModifyComment","userId","role","canModifyReply","className","children","urlAvatar","src","username","toUpperCase","charAt","Date","createdAt","toLocaleString","onClick","onChange","e","rows","type","accept","ref","htmlFor","disabled","alt","onError","style","display","length","placeholder","name","fullName","URL","createObjectURL","isOpen","onClose","onConfirm","title"],"sources":["C:/Users/TTC/OneDrive/Documents/GITHUB/fe-readhub/src/pages/forum_discussion/views/widgets/ForumCommentItem.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  ThumbsUp,\r\n  MessageCircle,\r\n  Share2,\r\n  MoreHorizontal,\r\n  Image,\r\n  Send,\r\n  X,\r\n  Edit2,\r\n  Trash2,\r\n  MoreVertical,\r\n} from 'lucide-react';\r\nimport { toast } from 'react-toastify';\r\nimport { DialogConfirmation } from '../../../../component/dialogs/DialogConfirmation';\r\nimport { Avatar } from '@mui/material';\r\n\r\nconst ForumCommentItem = ({ comment, stompClient, user, onCommentDeleted }) => {\r\n  // States for reply functionality\r\n  const [showReplyInput, setShowReplyInput] = useState(false);\r\n  const [replyContent, setReplyContent] = useState('');\r\n  const [replyImage, setReplyImage] = useState(null);\r\n  const [isSubmittingReply, setIsSubmittingReply] = useState(false);\r\n  const replyFileInputRef = useRef(null);\r\n\r\n  // States for like functionality\r\n  const [isLiked, setIsLiked] = useState(comment.likedByCurrentUser);\r\n  const [likeCount, setLikeCount] = useState(comment.likeCount || 0);\r\n\r\n  // States for replies\r\n  const [replies, setReplies] = useState(comment.replies || []);\r\n  const [showReplies, setShowReplies] = useState(false);\r\n\r\n  // States for editing comment\r\n  const [isEditing, setIsEditing] = useState(false);\r\n  const [editContent, setEditContent] = useState(comment.content);\r\n  const [editImage, setEditImage] = useState(null);\r\n  const [isSubmittingEdit, setIsSubmittingEdit] = useState(false);\r\n  const editFileInputRef = useRef(null);\r\n\r\n  // States for editing reply\r\n  const [editingReplyId, setEditingReplyId] = useState(null);\r\n  const [editReplyContent, setEditReplyContent] = useState('');\r\n  const [editReplyImage, setEditReplyImage] = useState(null);\r\n  const [isSubmittingReplyEdit, setIsSubmittingReplyEdit] = useState(false);\r\n\r\n  // States for dropdowns\r\n  const [showCommentOptions, setShowCommentOptions] = useState(false);\r\n  const [showReplyOptions, setShowReplyOptions] = useState(null);\r\n\r\n  const [showDeleteCommentDialog, setShowDeleteCommentDialog] = useState(false);\r\n  const [showDeleteReplyDialog, setShowDeleteReplyDialog] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (stompClient) {\r\n      // Subscribe to like updates\r\n      const likeSub = stompClient.subscribe(\r\n        `/topic/comment/${comment.id}/like`,\r\n        message => {\r\n          const response = JSON.parse(message.body);\r\n          setIsLiked(response.liked);\r\n          setLikeCount(prev => response.liked ? prev + 1 : prev - 1);\r\n        }\r\n      );\r\n\r\n      // Subscribe to reply updates\r\n      const replySub = stompClient.subscribe(\r\n        `/topic/comment/${comment.id}/reply`,\r\n        message => {\r\n          const newReply = JSON.parse(message.body);\r\n          setReplies(prev => [newReply, ...prev]);\r\n        }\r\n      );\r\n\r\n      // Subscribe to reply delete\r\n      const replyDeleteSub = stompClient.subscribe(\r\n        `/topic/comment/${comment.id}/reply/delete`,\r\n        message => {\r\n          const { replyId } = JSON.parse(message.body);\r\n          setReplies(prev => prev.filter(reply => reply.id !== replyId));\r\n          toast.success('Reply deleted successfully');\r\n        }\r\n      );\r\n\r\n      // Subscribe to reply update\r\n      const replyUpdateSub = stompClient.subscribe(\r\n        `/topic/reply/${comment.id}/update`,\r\n        message => {\r\n          const updatedReply = JSON.parse(message.body);\r\n          setReplies(prev =>\r\n            prev.map(reply =>\r\n              reply.id === updatedReply.id ? updatedReply : reply\r\n            )\r\n          );\r\n          setEditingReplyId(null);\r\n        }\r\n      );\r\n\r\n      // Subscribe to comment delete\r\n      const commentDeleteSub = stompClient.subscribe(\r\n        `/topic/comment/${comment.id}/delete`,\r\n        () => {\r\n          onCommentDeleted && onCommentDeleted(comment.id);\r\n          toast.success('Comment deleted successfully');\r\n        }\r\n      );\r\n\r\n      // Subscribe to comment update\r\n      const commentUpdateSub = stompClient.subscribe(\r\n        `/topic/comment/${comment.id}/update`,\r\n        message => {\r\n          const updatedComment = JSON.parse(message.body);\r\n          setEditContent(updatedComment.content);\r\n          setIsEditing(false);\r\n        }\r\n      );\r\n\r\n      // Subscribe to errors\r\n      const errorSub = stompClient.subscribe(\r\n        `/topic/errors/comment/${comment.id}`,\r\n        message => {\r\n          const error = JSON.parse(message.body);\r\n          toast.error(`Error: ${error.message}`);\r\n        }\r\n      );\r\n\r\n      return () => {\r\n        likeSub.unsubscribe();\r\n        replySub.unsubscribe();\r\n        replyDeleteSub.unsubscribe();\r\n        replyUpdateSub.unsubscribe();\r\n        commentDeleteSub.unsubscribe();\r\n        commentUpdateSub.unsubscribe();\r\n        errorSub.unsubscribe();\r\n      };\r\n    }\r\n  }, [stompClient, comment.id, onCommentDeleted]);\r\n\r\n  const handleLike = () => {\r\n    if (!user) {\r\n      toast.error('Please login to like comments');\r\n      return;\r\n    }\r\n\r\n    if (stompClient?.connected) {\r\n      stompClient.send(\r\n        '/app/comment/like',\r\n        {\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n        JSON.stringify({ commentId: comment.id })\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    if (stompClient?.connected) {\r\n      stompClient.send(\r\n        '/app/comment/delete',\r\n        {\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n        JSON.stringify({ commentId: comment.id })\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleEditSubmit = async () => {\r\n    if (!editContent.trim() && !editImage) return;\r\n    if (isSubmittingEdit) return;\r\n\r\n    try {\r\n      setIsSubmittingEdit(true);\r\n      let imageUrl = comment.imageUrl;\r\n\r\n      if (editImage) {\r\n        const formData = new FormData();\r\n        formData.append('file', editImage);\r\n        const response = await fetch('http://localhost:8080/api/v1/upload', {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        if (response.ok) {\r\n          const result = await response.json();\r\n          imageUrl = result.data.url;\r\n        }\r\n      }\r\n\r\n      if (stompClient?.connected) {\r\n        stompClient.send(\r\n          '/app/comment/update',\r\n          {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n          JSON.stringify({\r\n            commentId: comment.id,\r\n            content: editContent,\r\n            imageUrl,\r\n          })\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating comment:', error);\r\n      toast.error('Failed to update comment');\r\n    } finally {\r\n      setIsSubmittingEdit(false);\r\n    }\r\n  };\r\n\r\n  const handleReplyDelete = (replyId) => {\r\n    try {\r\n      if (!stompClient?.connected) {\r\n        toast.error('Connection lost. Please refresh the page.');\r\n        return;\r\n      }\r\n\r\n      stompClient.send(\r\n        '/app/comment/reply/delete',\r\n        {\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n        JSON.stringify({ replyId: replyId })\r\n      );\r\n\r\n      setShowReplyOptions(null);\r\n    } catch (error) {\r\n      console.error('Error deleting reply:', error);\r\n      toast.error('Failed to delete reply. Please try again.');\r\n    }\r\n  };\r\n\r\n  const handleReplyEdit = async (replyId) => {\r\n    if (!editReplyContent.trim() && !editReplyImage) return;\r\n    if (isSubmittingReplyEdit) return;\r\n\r\n    try {\r\n      setIsSubmittingReplyEdit(true);\r\n      let imageUrl = replies.find(r => r.id === replyId)?.imageUrl;\r\n\r\n      if (editReplyImage) {\r\n        const formData = new FormData();\r\n        formData.append('file', editReplyImage);\r\n        const response = await fetch('http://localhost:8080/api/v1/upload', {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        if (response.ok) {\r\n          const result = await response.json();\r\n          imageUrl = result.data.url;\r\n        }\r\n      }\r\n\r\n      if (stompClient?.connected) {\r\n        stompClient.send(\r\n          '/app/comment/reply/update',\r\n          {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n          JSON.stringify({\r\n            replyId: replyId,\r\n            content: editReplyContent,\r\n            imageUrl,\r\n          })\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating reply:', error);\r\n      toast.error('Failed to update reply');\r\n    } finally {\r\n      setIsSubmittingReplyEdit(false);\r\n    }\r\n  };\r\n\r\n  const handleReplyImageSelect = event => {\r\n    const file = event.target.files[0];\r\n    if (file) {\r\n      setReplyImage(file);\r\n    }\r\n  };\r\n\r\n  const handleSubmitReply = async () => {\r\n    if (!user) {\r\n      toast.error('Please login to reply');\r\n      return;\r\n    }\r\n\r\n    if (!replyContent.trim() && !replyImage) return;\r\n    if (isSubmittingReply) return;\r\n\r\n    try {\r\n      setIsSubmittingReply(true);\r\n      let imageUrl = null;\r\n\r\n      if (replyImage) {\r\n        const formData = new FormData();\r\n        formData.append('file', replyImage);\r\n        const response = await fetch('http://localhost:8080/api/v1/upload', {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        if (response.ok) {\r\n          const result = await response.json();\r\n          imageUrl = result.data.url;\r\n        }\r\n      }\r\n\r\n      if (stompClient?.connected) {\r\n        stompClient.send(\r\n          '/app/comment/reply',\r\n          {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n          JSON.stringify({\r\n            commentId: comment.id,\r\n            content: replyContent,\r\n            imageUrl,\r\n          })\r\n        );\r\n\r\n        setReplyContent('');\r\n        setReplyImage(null);\r\n        if (replyFileInputRef.current) {\r\n          replyFileInputRef.current.value = '';\r\n        }\r\n        setShowReplyInput(false);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error posting reply:', error);\r\n      toast.error('Failed to post reply');\r\n    } finally {\r\n      setIsSubmittingReply(false);\r\n    }\r\n  };\r\n\r\n  const canModifyComment = user && (user.userId === comment.user.userId || user.role === 'ROLE_ADMIN');\r\n  const canModifyReply = (reply) => user && (user.userId === reply.user.userId || user.role === 'ROLE_ADMIN');\r\n\r\n  return (\r\n    <div className=\"bg-white rounded-lg shadow-md p-6 mb-4\">\r\n      <div className=\"flex justify-between items-start mb-4\">\r\n        <div className=\"flex gap-4\">\r\n        {user.urlAvatar ? (\r\n                  <Avatar src={user.urlAvatar} />\r\n                ) : (\r\n                  <Avatar>\r\n                    {user.username\r\n                      ? user.username.toUpperCase().charAt(0)\r\n                      : 'U'}\r\n                  </Avatar>\r\n                )}\r\n          <div>\r\n            <h3 className=\"font-semibold text-lg\">{comment.user.username}</h3>\r\n            <p className=\"text-gray-500 text-sm\">\r\n              {new Date(comment.createdAt).toLocaleString()}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        {canModifyComment && (\r\n          <div className=\"relative\">\r\n            <button\r\n              className=\"text-gray-400 hover:text-gray-600\"\r\n              onClick={() => setShowCommentOptions(!showCommentOptions)}\r\n            >\r\n              <MoreVertical className=\"w-6 h-6\" />\r\n            </button>\r\n            {showCommentOptions && (\r\n              <div className=\"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10\">\r\n                <div className=\"py-1\" role=\"menu\">\r\n                  <button\r\n                    className=\"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2\"\r\n                    onClick={() => {\r\n                      setIsEditing(true);\r\n                      setShowCommentOptions(false);\r\n                    }}\r\n                  >\r\n                    <Edit2 className=\"w-4 h-4\" />\r\n                    Edit\r\n                  </button>\r\n                  <button\r\n                    className=\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 flex items-center gap-2\"\r\n                    onClick={() => {\r\n                      setShowDeleteCommentDialog(true);\r\n                      setShowCommentOptions(false);\r\n                    }}\r\n                  >\r\n                    <Trash2 className=\"w-4 h-4\" />\r\n                    Delete\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Comment Content */}\r\n      <div className=\"pl-16\">\r\n        {isEditing ? (\r\n          <div className=\"mb-4\">\r\n            <textarea\r\n              value={editContent}\r\n              onChange={(e) => setEditContent(e.target.value)}\r\n              className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n              rows=\"3\"\r\n            />\r\n            <div className=\"flex justify-between items-center mt-2\">\r\n              <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={(e) => setEditImage(e.target.files[0])}\r\n                ref={editFileInputRef}\r\n                className=\"hidden\"\r\n                id={`edit-image-${comment.id}`}\r\n              />\r\n              <label\r\n                htmlFor={`edit-image-${comment.id}`}\r\n                className=\"cursor-pointer flex items-center gap-2 text-gray-600 hover:text-blue-600\"\r\n              >\r\n                <Image className=\"w-4 h-4\" />\r\n                <span>Change Image</span>\r\n              </label>\r\n              <div className=\"flex gap-2\">\r\n                <button\r\n                  onClick={() => setIsEditing(false)}\r\n                  className=\"px-4 py-2 text-gray-600 hover:text-gray-800\"\r\n                >\r\n                  Cancel\r\n                </button>\r\n                <button\r\n                  onClick={handleEditSubmit}\r\n                  disabled={isSubmittingEdit}\r\n                  className={`${\r\n                    isSubmittingEdit\r\n                      ? 'bg-gray-400 cursor-not-allowed'\r\n                      : 'bg-blue-600 hover:bg-blue-700'\r\n                  } text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2`}\r\n                >\r\n                  {isSubmittingEdit ? (\r\n                    <>\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\" />\r\n                      <span>Saving...</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Send className=\"w-4 h-4\" />\r\n                      <span>Save</span>\r\n                    </>\r\n                  )}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <p className=\"text-gray-800 whitespace-pre-wrap mb-4\">\r\n              {comment.content}\r\n            </p>\r\n            {comment.imageUrl && (\r\n              <div className=\"mb-4\">\r\n                <img\r\n                  src={comment.imageUrl}\r\n                  alt=\"Comment attachment\"\r\n                  className=\"max-w-full rounded-lg\"\r\n                  onError={(e) => {\r\n                    console.error('Image load error:', e);\r\n                    e.target.style.display = 'none';\r\n                  }}\r\n                />\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"flex items-center gap-6 text-gray-500\">\r\n          <button\r\n            onClick={handleLike}\r\n            className={`flex items-center gap-2 transition-colors ${\r\n              isLiked ? 'text-blue-600' : 'hover:text-blue-600'\r\n            }`}\r\n          >\r\n            <ThumbsUp className=\"w-5 h-5\" />\r\n            <span>{likeCount}</span>\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => setShowReplyInput(!showReplyInput)}\r\n            className=\"flex items-center gap-2 hover:text-blue-600 transition-colors\"\r\n          >\r\n            <MessageCircle className=\"w-5 h-5\" />\r\n            <span>Reply{replies.length > 0 && ` (${replies.length})`}</span>\r\n          </button>\r\n\r\n          <button className=\"flex items-center gap-2 hover:text-blue-600 transition-colors\">\r\n            <Share2 className=\"w-5 h-5\" />\r\n            <span>Share</span>\r\n          </button>\r\n        </div>\r\n\r\n        {/* Reply Input */}\r\n        {showReplyInput && user && (\r\n          <div className=\"mt-4\">\r\n            <div className=\"flex gap-4\">\r\n            {user.urlAvatar ? (\r\n                  <Avatar src={user.urlAvatar} />\r\n                ) : (\r\n                  <Avatar>\r\n                    {user.username\r\n                      ? user.username.toUpperCase().charAt(0)\r\n                      : 'U'}\r\n                  </Avatar>\r\n                )}\r\n              <div className=\"flex-1\">\r\n                <textarea\r\n                  value={replyContent}\r\n                  onChange={(e) => setReplyContent(e.target.value)}\r\n                  placeholder=\"Write a reply...\"\r\n                  className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all resize-none\"\r\n                  rows=\"2\"\r\n                />\r\n                <div className=\"flex justify-between items-center mt-2\">\r\n                  <div className=\"flex items-center gap-4\">\r\n                    <input\r\n                      type=\"file\"\r\n                      accept=\"image/*\"\r\n                      onChange={handleReplyImageSelect}\r\n                      ref={replyFileInputRef}\r\n                      className=\"hidden\"\r\n                      id={`reply-image-${comment.id}`}\r\n                    />\r\n                    <label\r\n                      htmlFor={`reply-image-${comment.id}`}\r\n                      className=\"cursor-pointer flex items-center gap-2 text-gray-600 hover:text-blue-600 transition-colors\"\r\n                    >\r\n                      <Image className=\"w-4 h-4\" />\r\n                      <span>Add Image</span>\r\n                    </label>\r\n                    {replyImage && (\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <span className=\"text-sm text-gray-500\">\r\n                          {replyImage.name}\r\n                        </span>\r\n                        <button\r\n                          onClick={() => {\r\n                            setReplyImage(null);\r\n                            if (replyFileInputRef.current) {\r\n                              replyFileInputRef.current.value = '';\r\n                            }\r\n                          }}\r\n                          className=\"text-red-500 hover:text-red-700\"\r\n                        >\r\n                          <X className=\"w-4 h-4\" />\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <button\r\n                    onClick={handleSubmitReply}\r\n                    disabled={isSubmittingReply}\r\n                    className={`${\r\n                      isSubmittingReply\r\n                        ? 'bg-gray-400 cursor-not-allowed'\r\n                        : 'bg-blue-600 hover:bg-blue-700'\r\n                    } text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2`}\r\n                  >\r\n                    {isSubmittingReply ? (\r\n                      <>\r\n                        <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\" />\r\n                        <span>Sending...</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Send className=\"w-4 h-4\" />\r\n                        <span>Reply</span>\r\n                      </>\r\n                    )}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Replies List */}\r\n        {replies.length > 0 && (\r\n          <div className=\"mt-4\">\r\n            <button\r\n              onClick={() => setShowReplies(!showReplies)}\r\n              className=\"text-blue-600 hover:text-blue-700 mb-4\"\r\n            >\r\n              {showReplies ? 'Hide' : 'Show'} {replies.length} replies\r\n            </button>\r\n\r\n            {showReplies && (\r\n              <div className=\"space-y-4\">\r\n                {replies.map((reply) => (\r\n                  <div key={reply.id} className=\"flex gap-4\">\r\n                    {user.urlAvatar ? (\r\n                  <Avatar src={user.urlAvatar} />\r\n                ) : (\r\n                  <Avatar>\r\n                    {user.username\r\n                      ? user.username.toUpperCase().charAt(0)\r\n                      : 'U'}\r\n                  </Avatar>\r\n                )}\r\n                    <div className=\"flex-1\">\r\n                      <div className=\"bg-gray-50 p-4 rounded-lg\">\r\n                        <div className=\"flex justify-between items-start\">\r\n                          <div>\r\n                            <h4 className=\"font-semibold\">{reply.user.fullName}</h4>\r\n                            <p className=\"text-sm text-gray-500\">\r\n                              {new Date(reply.createdAt).toLocaleString()}\r\n                            </p>\r\n                          </div>\r\n                          {canModifyReply(reply) && (\r\n                            <div className=\"relative\">\r\n                              <button\r\n                                onClick={() => setShowReplyOptions(reply.id)}\r\n                                className=\"text-gray-400 hover:text-gray-600\"\r\n                              >\r\n                                <MoreVertical className=\"w-5 h-5\" />\r\n                              </button>\r\n                              {showReplyOptions === reply.id && (\r\n                                <div className=\"absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10\">\r\n                                  <div className=\"py-1\">\r\n                                    <button\r\n                                      className=\"w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2\"\r\n                                      onClick={() => {\r\n                                        setEditingReplyId(reply.id);\r\n                                        setEditReplyContent(reply.content);\r\n                                        setShowReplyOptions(null);\r\n                                      }}\r\n                                    >\r\n                                      <Edit2 className=\"w-4 h-4\" />\r\n                                      Edit\r\n                                    </button>\r\n                                    <button\r\n                                      className=\"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 flex items-center gap-2\"\r\n                                      onClick={() => {\r\n                                        setShowDeleteReplyDialog(reply.id);\r\n                                        setShowReplyOptions(null);\r\n                                      }}\r\n                                    >\r\n                                      <Trash2 className=\"w-4 h-4\" />\r\n                                      Delete\r\n                                    </button>\r\n                                  </div>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {editingReplyId === reply.id ? (\r\n  <div className=\"mt-2\">\r\n    <textarea\r\n      value={editReplyContent}\r\n      onChange={(e) => setEditReplyContent(e.target.value)}\r\n      className=\"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n      rows=\"2\"\r\n    />\r\n    <div className=\"flex justify-between items-center mt-2\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <input\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          onChange={(e) => setEditReplyImage(e.target.files[0])}\r\n          className=\"hidden\"\r\n          id={`edit-reply-image-${reply.id}`}\r\n        />\r\n        <label\r\n          htmlFor={`edit-reply-image-${reply.id}`}\r\n          className=\"cursor-pointer flex items-center gap-2 text-gray-600 hover:text-blue-600\"\r\n        >\r\n          <Image className=\"w-4 h-4\" />\r\n          <span>{reply.imageUrl ? 'Change Image' : 'Add Image'}</span>\r\n        </label>\r\n        {(editReplyImage || reply.imageUrl) && (\r\n          <div className=\"flex items-center gap-2\">\r\n            {editReplyImage ? (\r\n              <>\r\n                <span className=\"text-sm text-gray-500\">\r\n                  {editReplyImage.name}\r\n                </span>\r\n                <button\r\n                  onClick={() => {\r\n                    setEditReplyImage(null);\r\n                  }}\r\n                  className=\"text-red-500 hover:text-red-700\"\r\n                >\r\n                  <X className=\"w-4 h-4\" />\r\n                </button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <span className=\"text-sm text-gray-500\">Current image</span>\r\n                <button\r\n                  onClick={() => {\r\n                    // Set imageUrl to null in backend\r\n                    handleReplyEdit(reply.id, editReplyContent, null);\r\n                  }}\r\n                  className=\"text-red-500 hover:text-red-700\"\r\n                >\r\n                  <X className=\"w-4 h-4\" />\r\n                </button>\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"flex gap-2\">\r\n        <button\r\n          onClick={() => {\r\n            setEditingReplyId(null);\r\n            setEditReplyContent('');\r\n            setEditReplyImage(null);\r\n          }}\r\n          className=\"px-3 py-1 text-gray-600 hover:text-gray-800\"\r\n        >\r\n          Cancel\r\n        </button>\r\n        <button\r\n          onClick={() => handleReplyEdit(reply.id)}\r\n          disabled={isSubmittingReplyEdit}\r\n          className={`${\r\n            isSubmittingReplyEdit\r\n              ? 'bg-gray-400 cursor-not-allowed'\r\n              : 'bg-blue-600 hover:bg-blue-700'\r\n          } text-white px-3 py-1 rounded-lg transition-colors flex items-center gap-2`}\r\n        >\r\n          {isSubmittingReplyEdit ? (\r\n            <>\r\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\" />\r\n              <span>Saving...</span>\r\n            </>\r\n          ) : (\r\n            <>\r\n              <Send className=\"w-4 h-4\" />\r\n              <span>Save</span>\r\n            </>\r\n          )}\r\n        </button>\r\n      </div>\r\n    </div>\r\n    {/* Preview current or new image */}\r\n    {(editReplyImage || reply.imageUrl) && (\r\n      <div className=\"mt-2\">\r\n        {editReplyImage ? (\r\n          <img\r\n            src={URL.createObjectURL(editReplyImage)}\r\n            alt=\"Preview\"\r\n            className=\"max-w-full h-auto rounded-lg\"\r\n          />\r\n        ) : (\r\n          reply.imageUrl && (\r\n            <img\r\n              src={reply.imageUrl}\r\n              alt=\"Current attachment\"\r\n              className=\"max-w-full h-auto rounded-lg\"\r\n              onError={(e) => {\r\n                console.error('Image load error:', e);\r\n                e.target.style.display = 'none';\r\n              }}\r\n            />\r\n          )\r\n        )}\r\n      </div>\r\n    )}\r\n  </div>\r\n) : (\r\n  <>\r\n    <p className=\"mt-2 text-gray-800 whitespace-pre-wrap\">\r\n      {reply.content}\r\n    </p>\r\n    {reply.imageUrl && (\r\n      <img\r\n        src={reply.imageUrl}\r\n        alt=\"Reply attachment\"\r\n        className=\"mt-2 max-w-full rounded-lg\"\r\n        onError={(e) => {\r\n          console.error('Image load error:', e);\r\n          e.target.style.display = 'none';\r\n        }}\r\n      />\r\n    )}\r\n  </>\r\n)}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n      <DialogConfirmation\r\n        isOpen={showDeleteCommentDialog}\r\n        onClose={() => setShowDeleteCommentDialog(false)}\r\n        onConfirm={handleDelete}\r\n        title=\"Delete Comment\"\r\n        message=\"Are you sure you want to delete this comment? This action cannot be undone.\"\r\n      />\r\n\r\n      <DialogConfirmation\r\n        isOpen={showDeleteReplyDialog !== null}\r\n        onClose={() => setShowDeleteReplyDialog(null)}\r\n        onConfirm={() => handleReplyDelete(showDeleteReplyDialog)}\r\n        title=\"Delete Reply\"\r\n        message=\"Are you sure you want to delete this reply? This action cannot be undone.\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ForumCommentItem;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}