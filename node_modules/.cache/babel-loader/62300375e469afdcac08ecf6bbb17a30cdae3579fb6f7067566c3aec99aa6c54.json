{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from 'react';\nimport { getToken } from 'firebase/messaging';\nimport { messaging } from '../config/firebase';\nconst useFCM = () => {\n  _s();\n  const [fcmToken, setFcmToken] = useState(null);\n  useEffect(() => {\n    const initializeFCM = async () => {\n      try {\n        // Ensure service worker is registered and active\n        if (!('serviceWorker' in navigator)) {\n          throw new Error('Service Worker not supported');\n        }\n\n        // Register service worker\n        console.log('Registering service worker...');\n        const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');\n        console.log('Service Worker registered:', registration);\n\n        // Wait for the service worker to be ready\n        await navigator.serviceWorker.ready;\n        console.log('Service Worker is ready');\n\n        // Request notification permission\n        let permission = Notification.permission;\n        if (permission !== 'granted') {\n          console.log('Requesting notification permission...');\n          permission = await Notification.requestPermission();\n        }\n        console.log('Notification permission:', permission);\n        if (permission === 'granted') {\n          // Get FCM token\n          console.log('Getting FCM token...');\n          const token = await getToken(messaging, {\n            vapidKey: process.env.REACT_APP_FIREBASE_VAPID_KEY,\n            serviceWorkerRegistration: registration\n          });\n          if (token) {\n            console.log('FCM Token obtained:', token);\n\n            // Register with backend\n            const response = await fetch(`${process.env.REACT_APP_API_BASE_URL}/notifications/register-device`, {\n              method: 'POST',\n              headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${localStorage.getItem('token')}`\n              },\n              body: JSON.stringify({\n                fcmToken: token\n              })\n            });\n            if (response.ok) {\n              console.log('Device registered with backend successfully');\n              localStorage.setItem('fcmToken', token);\n              setFcmToken(token);\n            } else {\n              throw new Error('Failed to register device with backend');\n            }\n          }\n        }\n      } catch (error) {\n        console.error('FCM initialization error:', error);\n        // Clear invalid token\n        localStorage.removeItem('fcmToken');\n      }\n    };\n    const authToken = localStorage.getItem('token');\n    if (authToken) {\n      initializeFCM();\n    }\n    return () => {\n      // Cleanup if needed\n    };\n  }, []);\n  return fcmToken;\n};\n_s(useFCM, \"yWAJiCjqDmPGaZpTwZgC83E6p44=\");\nexport default useFCM;","map":{"version":3,"names":["useEffect","useState","getToken","messaging","useFCM","_s","fcmToken","setFcmToken","initializeFCM","navigator","Error","console","log","registration","serviceWorker","register","ready","permission","Notification","requestPermission","token","vapidKey","process","env","REACT_APP_FIREBASE_VAPID_KEY","serviceWorkerRegistration","response","fetch","REACT_APP_API_BASE_URL","method","headers","localStorage","getItem","body","JSON","stringify","ok","setItem","error","removeItem","authToken"],"sources":["C:/Users/TTC/OneDrive/Documents/GITHUB/fe-readhub/src/hooks/useFCM.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { getToken } from 'firebase/messaging';\r\nimport { messaging } from '../config/firebase';\r\n\r\nconst useFCM = () => {\r\n  const [fcmToken, setFcmToken] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const initializeFCM = async () => {\r\n      try {\r\n        // Ensure service worker is registered and active\r\n        if (!('serviceWorker' in navigator)) {\r\n          throw new Error('Service Worker not supported');\r\n        }\r\n\r\n        // Register service worker\r\n        console.log('Registering service worker...');\r\n        const registration = await navigator.serviceWorker.register('/firebase-messaging-sw.js');\r\n        console.log('Service Worker registered:', registration);\r\n\r\n        // Wait for the service worker to be ready\r\n        await navigator.serviceWorker.ready;\r\n        console.log('Service Worker is ready');\r\n\r\n        // Request notification permission\r\n        let permission = Notification.permission;\r\n        if (permission !== 'granted') {\r\n          console.log('Requesting notification permission...');\r\n          permission = await Notification.requestPermission();\r\n        }\r\n        console.log('Notification permission:', permission);\r\n\r\n        if (permission === 'granted') {\r\n          // Get FCM token\r\n          console.log('Getting FCM token...');\r\n          const token = await getToken(messaging, {\r\n            vapidKey: process.env.REACT_APP_FIREBASE_VAPID_KEY,\r\n            serviceWorkerRegistration: registration\r\n          });\r\n\r\n          if (token) {\r\n            console.log('FCM Token obtained:', token);\r\n\r\n            // Register with backend\r\n            const response = await fetch(`${process.env.REACT_APP_API_BASE_URL}/notifications/register-device`, {\r\n              method: 'POST',\r\n              headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${localStorage.getItem('token')}`\r\n              },\r\n              body: JSON.stringify({ fcmToken: token })\r\n            });\r\n\r\n            if (response.ok) {\r\n              console.log('Device registered with backend successfully');\r\n              localStorage.setItem('fcmToken', token);\r\n              setFcmToken(token);\r\n            } else {\r\n              throw new Error('Failed to register device with backend');\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('FCM initialization error:', error);\r\n        // Clear invalid token\r\n        localStorage.removeItem('fcmToken');\r\n      }\r\n    };\r\n\r\n    const authToken = localStorage.getItem('token');\r\n    if (authToken) {\r\n      initializeFCM();\r\n    }\r\n\r\n    return () => {\r\n      // Cleanup if needed\r\n    };\r\n  }, []);\r\n\r\n  return fcmToken;\r\n};\r\n\r\nexport default useFCM;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}