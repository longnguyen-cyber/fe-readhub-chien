{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useLocation,useNavigate}from'react-router-dom';import{ReactReaderStyle}from'react-reader';import ePub from'epubjs';import ReaderHeader from'./ReaderHeader';import ReaderContent from'./ReaderContent';import NotePopover from'./NotePopover';import NotesDrawer from'./NotesDrawer';import SettingsDrawer from'./SettingsDrawer';import{Button,Select,MenuItem,TextField,DialogActions,Dialog,DialogTitle,DialogContent}from'@mui/material';import axios from'axios';import{toast}from'react-toastify';import'react-toastify/dist/ReactToastify.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const colors=['#FFB3BA','#FFDFBA','#FFFFBA','#BAFFC9','#BAE1FF'];const themes=['#FFFFFF','#faf6ed','#121212'];const fontFamilies=['Times New Roman','Arial','Georgia','Verdana'];const defaultSettings={theme:themes[0],pageView:'double',fontFamily:fontFamilies[0],fontSize:16,fontWeight:400,lineHeight:1.2,zoom:100};function ReadBookScreen(){const navigate=useNavigate();const location=useLocation();const[loca,setLocation]=useState(location||'');const{bookId,bookTitle}=location.state||{};const[error,setError]=useState(null);const[loading,setLoading]=useState(false);const[epubUrl,setEpubUrl]=useState(null);const[selections,setSelections]=useState([]);const[drawerOpen,setDrawerOpen]=useState(false);const[rendition,setRendition]=useState(null);const[highlightColor,setHighlightColor]=useState(colors[0]);const[comment,setComment]=useState('');const[popoverAnchor,setPopoverAnchor]=useState(null);const[selectedText,setSelectedText]=useState('');const[selectedCfiRange,setSelectedCfiRange]=useState('');const[searchTerm,setSearchTerm]=useState('');const[filter,setFilter]=useState('all');const[editingNote,setEditingNote]=useState(null);const[settingsDrawerOpen,setSettingsDrawerOpen]=useState(false);const[settings,setSettings]=useState(defaultSettings);const[user,setUser]=useState(null);const[isNote,setIsNote]=useState(false);const[hasBookmark,setHasBookmark]=useState(false);const[currentLocation,setCurrentLocation]=useState(null);const[readStartTime,setReadStartTime]=useState(null);const[bookmarkId,setBookmarkId]=useState(null);const[lastReadingUpdate,setLastReadingUpdate]=useState(null);const[isActive,setIsActive]=useState(true);const[activeHighlights]=useState(new Set());const startReadingSession=()=>{setReadStartTime(Date.now());};const updateReadingHistory=async()=>{const currentTime=Date.now();const timeSpent=Math.floor((currentTime-lastReadingUpdate)/1000);try{await axios.post('http://localhost:8080/api/v1/reading-history',{userId:user.userId,bookId:bookId,timeSpent:timeSpent},{headers:{'Content-Type':'application/json',Authorization:`Bearer ${localStorage.getItem('token')}`}});setLastReadingUpdate(currentTime);}catch(error){console.error('Error updating reading history:',error);}};const saveBookmark=async location=>{if(!user||!bookId)return;try{await axios.post('http://localhost:8080/api/v1/bookmark',{userId:user.userId,bookId:bookId,location:loca},{headers:{'Content-Type':'application/json',Authorization:`Bearer ${localStorage.getItem('token')}`}});setHasBookmark(true);toast.success('Đã lưu đánh dấu trang');}catch(error){console.error('Error saving bookmark:',error);toast.error('Có lỗi xảy ra khi lưu đánh dấu trang','error');}};const getUser=async()=>{if(!localStorage.getItem('token'))return;try{const response=await axios.get('http://localhost:8080/api/v1/user/profile',{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});setUser(response.data);}catch(error){console.error(error);}};const getNotes=async()=>{if(!(user!==null&&user!==void 0&&user.userId)||!bookId||!rendition)return;try{const response=await axios.get(`http://localhost:8080/api/v1/note/user/${user.userId}/book/${bookId}`,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});const notesData=Array.isArray(response.data.data)?response.data.data:[];setSelections(notesData);}catch(error){console.error('Error fetching notes:',error);setSelections([]);}};const handleEditNote=note=>{setEditingNote(note);};const handleSaveEdit=async()=>{try{await axios.put(`http://localhost:8080/api/v1/note`,editingNote,{headers:{'Content-Type':'application/json',Authorization:`Bearer ${localStorage.getItem('token')}`}});if(editingNote){setSelections(selections.map(s=>s.cfiRange===editingNote.cfiRange?editingNote:s));// Xóa highlight cũ\nrendition.annotations.remove(editingNote.cfiRange,'highlight');activeHighlights.delete(editingNote.cfiRange);// Tạo highlight mới với màu đã cập nhật\nrendition.annotations.add('highlight',editingNote.cfiRange,{},null,'hl',{fill:editingNote.color,'fill-opacity':'0.3','mix-blend-mode':'multiply'});activeHighlights.add(editingNote.cfiRange);setIsNote(!isNote);setEditingNote(null);// Đóng dialog\n}}catch(error){console.error('Error updating note:',error);}};const getBookmark=async()=>{if(!user||!bookId)return;try{const response=await axios.get(`http://localhost:8080/api/v1/bookmark/user/${user.userId}/book/${bookId}`,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});if(response.data){setHasBookmark(true);setBookmarkId(response.data.data.bookmarkId);setLocation(response.data.data.location);}}catch(error){console.error('Error fetching bookmark:',error);}};const handleToggleBookmark=async()=>{if(!user||!bookId)return;if(hasBookmark&&bookmarkId){try{await axios.put('http://localhost:8080/api/v1/bookmark',{bookmarkId:bookmarkId,userId:user.userId,bookId:bookId,location:loca},{headers:{'Content-Type':'application/json',Authorization:`Bearer ${localStorage.getItem('token')}`}});toast.success('Đã đánh dấu trang');}catch(error){toast.error('Có lỗi xảy ra khi đánh dấu trang','error');}}else{await saveBookmark(currentLocation);}};const handleError=error=>{console.error('Error in ReactReader:',error);setError('An error occurred while loading the book. Please try again later.');setLoading(false);};const handleToggleDrawer=()=>{setDrawerOpen(!drawerOpen);};const handleSettingsDrawerToggle=()=>{setSettingsDrawerOpen(!settingsDrawerOpen);};const applySettings=()=>{if(rendition){// Xóa toàn bộ highlight hiện tại trước\nactiveHighlights.forEach(cfiRange=>{rendition.annotations.remove(cfiRange,'highlight');});activeHighlights.clear();// Apply settings mới\nrendition.themes.default({body:{background:settings.theme,color:settings.theme==='#121212'?'#FFFFFF':'#000000','font-family':settings.fontFamily==='Default'?'inherit':settings.fontFamily,'font-size':`${settings.fontSize}px`,'font-weight':settings.fontWeight,'line-height':settings.lineHeight,transform:`scale(${settings.zoom/100})`,'transform-origin':'top left'},'a, a:link, a:visited, a:hover, a:active':{color:'inherit !important','-webkit-text-fill-color':'inherit !important','text-decoration':'none'},'::selection':{'background-color':'rgba(0, 0, 255, 0.1)',color:'inherit'},'*':{transition:'none !important'}});rendition.themes.select('default');if(settings.pageView==='double'){rendition.spread('auto');}else{rendition.spread('none');}// Apply lại highlight sau khi settings đã được cập nhật\nsetTimeout(()=>{selections.forEach(note=>{rendition.annotations.add('highlight',note.cfiRange,{},null,'hl',{fill:note.color,'fill-opacity':'0.3','mix-blend-mode':'multiply'});activeHighlights.add(note.cfiRange);});},50);}};const updateSettings=(key,value)=>{setSettings(prev=>({...prev,[key]:value}));if(['fontSize','fontWeight','lineHeight','zoom'].includes(key)){rendition.clear();rendition.themes.default({body:{background:settings.theme,color:settings.theme==='#121212'?'#FFFFFF':'#000000','font-family':settings.fontFamily,'font-size':`${value}px`,'font-weight':key==='fontWeight'?value:settings.fontWeight,'line-height':key==='lineHeight'?value:settings.lineHeight,transform:key==='zoom'?`scale(${value/100})`:`scale(${settings.zoom/100})`,'transform-origin':'top left'}});rendition.display(loca);}};const handleResetSettings=()=>{setSettings(defaultSettings);};// Event Listeners and Effect Hooks\nuseEffect(()=>{applySettings();},[settings]);useEffect(()=>{if(user!==null&&user!==void 0&&user.userId&&bookId){setLastReadingUpdate(Date.now());setIsActive(true);const intervalId=setInterval(()=>{if(isActive){updateReadingHistory();}},5*60*1000);return()=>{updateReadingHistory();clearInterval(intervalId);};}},[user,bookId]);useEffect(()=>{const handleVisibilityChange=()=>{if(document.hidden){setIsActive(false);updateReadingHistory();}else{setIsActive(true);setLastReadingUpdate(Date.now());}};document.addEventListener('visibilitychange',handleVisibilityChange);return()=>{document.removeEventListener('visibilitychange',handleVisibilityChange);};},[]);useEffect(()=>{const epubUrl=`https://www.gutenberg.org/cache/epub/${bookId}/pg${bookId}.epub`;setEpubUrl(epubUrl);getUser();},[bookId]);useEffect(()=>{const handleBeforeUnload=()=>{updateReadingHistory();};window.addEventListener('beforeunload',handleBeforeUnload);return()=>{window.removeEventListener('beforeunload',handleBeforeUnload);};},[]);useEffect(()=>{getBookmark();},[user]);useEffect(()=>{if(user&&bookId){getNotes();}},[user,bookId,rendition,isNote]);useEffect(()=>{if(rendition){const handleSelection=(cfiRange,contents)=>{const selection=contents.window.getSelection();const text=selection.toString().trim();// Lấy text và trim luôn\n// Chỉ xử lý khi có text thật sự\nif(text){const range=selection.getRangeAt(0);setSelectedText(text);setSelectedCfiRange(cfiRange);const rect=range.getBoundingClientRect();const viewportHeight=window.innerHeight;const viewportWidth=window.innerWidth;setPopoverAnchor({top:rect.top<viewportHeight/2?rect.bottom+window.scrollY+115:rect.top+window.scrollY-60,left:viewportWidth/2+5});}};rendition.on('selected',handleSelection);rendition.themes.default({'::selection':{background:'rgba(0, 0, 255, 0.1)',color:'inherit'},'a:link':{color:'inherit !important','-webkit-text-fill-color':'inherit !important'},'a:hover':{color:'inherit !important','-webkit-text-fill-color':'inherit !important'}});return()=>{rendition.off('selected',handleSelection);};}},[rendition]);// Highlight Management\nuseEffect(()=>{if(rendition){const applyHighlight=note=>{if(!activeHighlights.has(note.cfiRange)){rendition.annotations.add('highlight',note.cfiRange,{},null,'hl',{fill:note.color,'fill-opacity':'0.3','mix-blend-mode':'multiply','white-space':'pre-wrap',// Giữ nguyên khoảng trắng\n'box-decoration-break':'clone'// Đảm bảo highlight không vượt quá text\n});activeHighlights.add(note.cfiRange);}};const removeHighlight=cfiRange=>{rendition.annotations.remove(cfiRange,'highlight');activeHighlights.delete(cfiRange);};const refreshHighlights=()=>{// Xóa những highlight không còn trong selections\nfor(const cfiRange of activeHighlights){if(!selections.some(note=>note.cfiRange===cfiRange)){removeHighlight(cfiRange);}}// Thêm những highlight mới\nselections.forEach(note=>{if(!activeHighlights.has(note.cfiRange)){applyHighlight(note);}});};refreshHighlights();// Handler cho việc di chuyển trang\nconst handleRelocated=()=>{selections.forEach(note=>{if(!activeHighlights.has(note.cfiRange)){applyHighlight(note);}});};rendition.on('relocated',handleRelocated);return()=>{rendition.off('relocated',handleRelocated);// Không xóa highlights khi unmount để tránh việc phải render lại\n};}},[rendition,selections]);const handleSave=async()=>{if(comment&&selectedCfiRange){const newNote={userId:user.userId,bookId:bookId,content:comment,selectedText:selectedText,cfiRange:selectedCfiRange,color:highlightColor};try{const response=await axios.post('http://localhost:8080/api/v1/note',newNote,{headers:{'Content-Type':'application/json',Authorization:`Bearer ${localStorage.getItem('token')}`}});const createdNote=response.data;setSelections(prev=>[...prev,createdNote]);setPopoverAnchor(null);setComment('');setSelectedText('');setSelectedCfiRange('');setIsNote(!isNote);}catch(error){console.error('Error creating note:',error);}}};const handleRemoveHighlight=async(cfiRange,noteId)=>{try{await axios.delete(`http://localhost:8080/api/v1/note/${noteId}`,{headers:{Authorization:`Bearer ${localStorage.getItem('token')}`}});// Xóa highlight cụ thể\nrendition.annotations.remove(cfiRange,'highlight');activeHighlights.delete(cfiRange);// Cập nhật state\nsetSelections(selections.filter(s=>s.cfiRange!==cfiRange));}catch(error){console.error('Error deleting note:',error);}};const filteredSelections=Array.isArray(selections)?selections.filter(selection=>{var _selection$selectedTe,_selection$selectedTe2,_selection$content$to,_selection$content;const isTextMatch=((_selection$selectedTe=(_selection$selectedTe2=selection.selectedText)===null||_selection$selectedTe2===void 0?void 0:_selection$selectedTe2.toLowerCase().includes(searchTerm.toLowerCase()))!==null&&_selection$selectedTe!==void 0?_selection$selectedTe:false)||((_selection$content$to=(_selection$content=selection.content)===null||_selection$content===void 0?void 0:_selection$content.toLowerCase().includes(searchTerm.toLowerCase()))!==null&&_selection$content$to!==void 0?_selection$content$to:false);const isColorMatch=filter==='all'||selection.color===filter;return isTextMatch&&isColorMatch;}).sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt)):[];const readerStyles={...ReactReaderStyle,readerArea:{...ReactReaderStyle.readerArea,backgroundColor:settings.theme,color:settings.theme==='#121212'?'#FFFFFF':'#000000'}};return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",style:{height:'100vh',display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsx(ReaderHeader,{title:bookTitle,onBack:()=>navigate(-1),onToggleNotes:handleToggleDrawer,onToggleSettings:handleSettingsDrawerToggle,user:user,onToggleBookmark:handleToggleBookmark,hasBookmark:hasBookmark,currentLocation:currentLocation}),loading&&/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:'red'},children:error}),/*#__PURE__*/_jsx(ReaderContent,{epubUrl:epubUrl,location:loca,onLocationChanged:loc=>setLocation(loc),onGetRendition:_rendition=>{setRendition(_rendition);// Apply default settings ngay khi rendition được tạo\n_rendition.themes.default({body:{background:defaultSettings.theme,color:defaultSettings.theme==='#121212'?'#FFFFFF':'#000000','font-family':defaultSettings.fontFamily,'font-size':`${defaultSettings.fontSize}px`,'font-weight':defaultSettings.fontWeight,'line-height':defaultSettings.lineHeight,transform:`scale(${defaultSettings.zoom/100})`,'transform-origin':'top left'},'a, a:link, a:visited, a:hover, a:active':{color:'inherit !important','-webkit-text-fill-color':'inherit !important','text-decoration':'none'},'::selection':{'background-color':'rgba(0, 0, 255, 0.1)',color:'inherit'},'*':{transition:'none !important'}});_rendition.themes.select('default');if(defaultSettings.pageView==='double'){_rendition.spread('auto');}else{_rendition.spread('none');}_rendition.on('started',()=>setLoading(false));},onError:handleError,readerStyles:readerStyles}),/*#__PURE__*/_jsx(NotePopover,{anchorPosition:popoverAnchor,open:Boolean(popoverAnchor),onClose:()=>setPopoverAnchor(null),colors:colors,highlightColor:highlightColor,setHighlightColor:setHighlightColor,comment:comment,setComment:setComment,onSave:handleSave}),/*#__PURE__*/_jsx(NotesDrawer,{open:drawerOpen,onClose:handleToggleDrawer,searchTerm:searchTerm,setSearchTerm:setSearchTerm,filter:filter,setFilter:setFilter,colors:colors,filteredSelections:filteredSelections,rendition:rendition,onRemoveHighlight:handleRemoveHighlight,onEditNote:handleEditNote}),/*#__PURE__*/_jsxs(Dialog,{open:Boolean(editingNote),onClose:()=>setEditingNote(null),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Edit Note\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"Comment\",fullWidth:true,multiline:true,rows:4,value:(editingNote===null||editingNote===void 0?void 0:editingNote.content)||'',onChange:e=>setEditingNote({...editingNote,content:e.target.value})}),/*#__PURE__*/_jsx(Select,{value:(editingNote===null||editingNote===void 0?void 0:editingNote.color)||colors[0],onChange:e=>setEditingNote({...editingNote,color:e.target.value}),fullWidth:true,style:{marginTop:'10px'},children:colors.map((color,index)=>/*#__PURE__*/_jsx(MenuItem,{value:color,children:/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:color,padding:'2px 10px',borderRadius:'5px',color:color},children:`ColorColorColorColorColorColori`})},index))})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setEditingNote(null),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSaveEdit,children:\"Save\"})]})]}),/*#__PURE__*/_jsx(SettingsDrawer,{open:settingsDrawerOpen,onClose:handleSettingsDrawerToggle,settings:settings,updateSettings:updateSettings,themes:themes,fontFamilies:fontFamilies,onResetSettings:handleResetSettings})]});}export default ReadBookScreen;","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","ReactReaderStyle","ePub","ReaderHeader","ReaderContent","NotePopover","NotesDrawer","SettingsDrawer","Button","Select","MenuItem","TextField","DialogActions","Dialog","DialogTitle","DialogContent","axios","toast","jsx","_jsx","jsxs","_jsxs","colors","themes","fontFamilies","defaultSettings","theme","pageView","fontFamily","fontSize","fontWeight","lineHeight","zoom","ReadBookScreen","navigate","location","loca","setLocation","bookId","bookTitle","state","error","setError","loading","setLoading","epubUrl","setEpubUrl","selections","setSelections","drawerOpen","setDrawerOpen","rendition","setRendition","highlightColor","setHighlightColor","comment","setComment","popoverAnchor","setPopoverAnchor","selectedText","setSelectedText","selectedCfiRange","setSelectedCfiRange","searchTerm","setSearchTerm","filter","setFilter","editingNote","setEditingNote","settingsDrawerOpen","setSettingsDrawerOpen","settings","setSettings","user","setUser","isNote","setIsNote","hasBookmark","setHasBookmark","currentLocation","setCurrentLocation","readStartTime","setReadStartTime","bookmarkId","setBookmarkId","lastReadingUpdate","setLastReadingUpdate","isActive","setIsActive","activeHighlights","Set","startReadingSession","Date","now","updateReadingHistory","currentTime","timeSpent","Math","floor","post","userId","headers","Authorization","localStorage","getItem","console","saveBookmark","success","getUser","response","get","data","getNotes","notesData","Array","isArray","handleEditNote","note","handleSaveEdit","put","map","s","cfiRange","annotations","remove","delete","add","fill","color","getBookmark","handleToggleBookmark","handleError","handleToggleDrawer","handleSettingsDrawerToggle","applySettings","forEach","clear","default","body","background","transform","transition","select","spread","setTimeout","updateSettings","key","value","prev","includes","display","handleResetSettings","intervalId","setInterval","clearInterval","handleVisibilityChange","document","hidden","addEventListener","removeEventListener","handleBeforeUnload","window","handleSelection","contents","selection","getSelection","text","toString","trim","range","getRangeAt","rect","getBoundingClientRect","viewportHeight","innerHeight","viewportWidth","innerWidth","top","bottom","scrollY","left","on","off","applyHighlight","has","removeHighlight","refreshHighlights","some","handleRelocated","handleSave","newNote","content","createdNote","handleRemoveHighlight","noteId","filteredSelections","_selection$selectedTe","_selection$selectedTe2","_selection$content$to","_selection$content","isTextMatch","toLowerCase","isColorMatch","sort","a","b","createdAt","readerStyles","readerArea","backgroundColor","className","style","height","flexDirection","children","title","onBack","onToggleNotes","onToggleSettings","onToggleBookmark","onLocationChanged","loc","onGetRendition","_rendition","onError","anchorPosition","open","Boolean","onClose","onSave","onRemoveHighlight","onEditNote","autoFocus","margin","label","fullWidth","multiline","rows","onChange","e","target","marginTop","index","padding","borderRadius","onClick","onResetSettings"],"sources":["C:/Users/TTC/OneDrive/Documents/GITHUB/fe-readhub/src/pages/read_book/views/ReadBookScreen.js"],"sourcesContent":["import React, {useEffect, useState} from 'react'\r\nimport {useLocation, useNavigate} from 'react-router-dom'\r\nimport {ReactReaderStyle} from 'react-reader'\r\nimport ePub from 'epubjs'\r\nimport ReaderHeader from './ReaderHeader'\r\nimport ReaderContent from './ReaderContent'\r\nimport NotePopover from './NotePopover'\r\nimport NotesDrawer from './NotesDrawer'\r\nimport SettingsDrawer from './SettingsDrawer'\r\nimport {\r\n  Button,\r\n  Select,\r\n  MenuItem,\r\n  TextField,\r\n  DialogActions,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n} from '@mui/material'\r\nimport axios from 'axios'\r\nimport {toast} from 'react-toastify'\r\nimport 'react-toastify/dist/ReactToastify.css'\r\n\r\nconst colors = ['#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9', '#BAE1FF']\r\nconst themes = ['#FFFFFF', '#faf6ed', '#121212']\r\nconst fontFamilies = ['Times New Roman', 'Arial', 'Georgia', 'Verdana']\r\nconst defaultSettings = {\r\n  theme: themes[0],\r\n  pageView: 'double',\r\n  fontFamily: fontFamilies[0],\r\n  fontSize: 16,\r\n  fontWeight: 400,\r\n  lineHeight: 1.2,\r\n  zoom: 100,\r\n}\r\n\r\nfunction ReadBookScreen() {\r\n  const navigate = useNavigate()\r\n  const location = useLocation()\r\n  const [loca, setLocation] = useState(location || '')\r\n  const {bookId, bookTitle} = location.state || {}\r\n  const [error, setError] = useState(null)\r\n  const [loading, setLoading] = useState(false)\r\n  const [epubUrl, setEpubUrl] = useState(null)\r\n  const [selections, setSelections] = useState([])\r\n  const [drawerOpen, setDrawerOpen] = useState(false)\r\n  const [rendition, setRendition] = useState(null)\r\n  const [highlightColor, setHighlightColor] = useState(colors[0])\r\n  const [comment, setComment] = useState('')\r\n  const [popoverAnchor, setPopoverAnchor] = useState(null)\r\n  const [selectedText, setSelectedText] = useState('')\r\n  const [selectedCfiRange, setSelectedCfiRange] = useState('')\r\n  const [searchTerm, setSearchTerm] = useState('')\r\n  const [filter, setFilter] = useState('all')\r\n  const [editingNote, setEditingNote] = useState(null)\r\n  const [settingsDrawerOpen, setSettingsDrawerOpen] = useState(false)\r\n  const [settings, setSettings] = useState(defaultSettings)\r\n  const [user, setUser] = useState(null)\r\n  const [isNote, setIsNote] = useState(false)\r\n  const [hasBookmark, setHasBookmark] = useState(false)\r\n  const [currentLocation, setCurrentLocation] = useState(null)\r\n  const [readStartTime, setReadStartTime] = useState(null)\r\n  const [bookmarkId, setBookmarkId] = useState(null)\r\n  const [lastReadingUpdate, setLastReadingUpdate] = useState(null)\r\n  const [isActive, setIsActive] = useState(true)\r\n  const [activeHighlights] = useState(new Set())\r\n\r\n  const startReadingSession = () => {\r\n    setReadStartTime(Date.now())\r\n  }\r\n\r\n  const updateReadingHistory = async () => {\r\n    const currentTime = Date.now()\r\n    const timeSpent = Math.floor((currentTime - lastReadingUpdate) / 1000)\r\n\r\n    try {\r\n      await axios.post(\r\n        'http://localhost:8080/api/v1/reading-history',\r\n        {\r\n          userId: user.userId,\r\n          bookId: bookId,\r\n          timeSpent: timeSpent,\r\n        },\r\n        {\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n      setLastReadingUpdate(currentTime)\r\n    } catch (error) {\r\n      console.error('Error updating reading history:', error)\r\n    }\r\n  }\r\n\r\n  const saveBookmark = async location => {\r\n    if (!user || !bookId) return\r\n\r\n    try {\r\n      await axios.post(\r\n        'http://localhost:8080/api/v1/bookmark',\r\n        {\r\n          userId: user.userId,\r\n          bookId: bookId,\r\n          location: loca,\r\n        },\r\n        {\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n      setHasBookmark(true)\r\n      toast.success('Đã lưu đánh dấu trang')\r\n    } catch (error) {\r\n      console.error('Error saving bookmark:', error)\r\n      toast.error('Có lỗi xảy ra khi lưu đánh dấu trang', 'error')\r\n    }\r\n  }\r\n\r\n  const getUser = async () => {\r\n    if (!localStorage.getItem('token')) return\r\n    try {\r\n      const response = await axios.get(\r\n        'http://localhost:8080/api/v1/user/profile',\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n      setUser(response.data)\r\n    } catch (error) {\r\n      console.error(error)\r\n    }\r\n  }\r\n\r\n  const getNotes = async () => {\r\n    if (!user?.userId || !bookId || !rendition) return\r\n    try {\r\n      const response = await axios.get(\r\n        `http://localhost:8080/api/v1/note/user/${user.userId}/book/${bookId}`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n\r\n      const notesData = Array.isArray(response.data.data)\r\n        ? response.data.data\r\n        : []\r\n      setSelections(notesData)\r\n    } catch (error) {\r\n      console.error('Error fetching notes:', error)\r\n      setSelections([])\r\n    }\r\n  }\r\n\r\n  const handleEditNote = note => {\r\n    setEditingNote(note)\r\n  }\r\n\r\n  const handleSaveEdit = async () => {\r\n    try {\r\n      await axios.put(`http://localhost:8080/api/v1/note`, editingNote, {\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n      })\r\n\r\n      if (editingNote) {\r\n        setSelections(\r\n          selections.map(s =>\r\n            s.cfiRange === editingNote.cfiRange ? editingNote : s,\r\n          ),\r\n        )\r\n\r\n        // Xóa highlight cũ\r\n        rendition.annotations.remove(editingNote.cfiRange, 'highlight')\r\n        activeHighlights.delete(editingNote.cfiRange)\r\n\r\n        // Tạo highlight mới với màu đã cập nhật\r\n        rendition.annotations.add(\r\n          'highlight',\r\n          editingNote.cfiRange,\r\n          {},\r\n          null,\r\n          'hl',\r\n          {\r\n            fill: editingNote.color,\r\n            'fill-opacity': '0.3',\r\n            'mix-blend-mode': 'multiply',\r\n          },\r\n        )\r\n        activeHighlights.add(editingNote.cfiRange)\r\n\r\n        setIsNote(!isNote)\r\n        setEditingNote(null) // Đóng dialog\r\n      }\r\n    } catch (error) {\r\n      console.error('Error updating note:', error)\r\n    }\r\n  }\r\n\r\n  const getBookmark = async () => {\r\n    if (!user || !bookId) return\r\n    try {\r\n      const response = await axios.get(\r\n        `http://localhost:8080/api/v1/bookmark/user/${user.userId}/book/${bookId}`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n          },\r\n        },\r\n      )\r\n\r\n      if (response.data) {\r\n        setHasBookmark(true)\r\n        setBookmarkId(response.data.data.bookmarkId)\r\n        setLocation(response.data.data.location)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching bookmark:', error)\r\n    }\r\n  }\r\n\r\n  const handleToggleBookmark = async () => {\r\n    if (!user || !bookId) return\r\n\r\n    if (hasBookmark && bookmarkId) {\r\n      try {\r\n        await axios.put(\r\n          'http://localhost:8080/api/v1/bookmark',\r\n          {\r\n            bookmarkId: bookmarkId,\r\n            userId: user.userId,\r\n            bookId: bookId,\r\n            location: loca,\r\n          },\r\n          {\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n            },\r\n          },\r\n        )\r\n        toast.success('Đã đánh dấu trang')\r\n      } catch (error) {\r\n        toast.error('Có lỗi xảy ra khi đánh dấu trang', 'error')\r\n      }\r\n    } else {\r\n      await saveBookmark(currentLocation)\r\n    }\r\n  }\r\n\r\n  const handleError = error => {\r\n    console.error('Error in ReactReader:', error)\r\n    setError(\r\n      'An error occurred while loading the book. Please try again later.',\r\n    )\r\n    setLoading(false)\r\n  }\r\n\r\n  const handleToggleDrawer = () => {\r\n    setDrawerOpen(!drawerOpen)\r\n  }\r\n\r\n  const handleSettingsDrawerToggle = () => {\r\n    setSettingsDrawerOpen(!settingsDrawerOpen)\r\n  }\r\n\r\n  const applySettings = () => {\r\n    if (rendition) {\r\n      // Xóa toàn bộ highlight hiện tại trước\r\n      activeHighlights.forEach(cfiRange => {\r\n        rendition.annotations.remove(cfiRange, 'highlight')\r\n      })\r\n      activeHighlights.clear()\r\n\r\n      // Apply settings mới\r\n      rendition.themes.default({\r\n        body: {\r\n          background: settings.theme,\r\n          color: settings.theme === '#121212' ? '#FFFFFF' : '#000000',\r\n          'font-family':\r\n            settings.fontFamily === 'Default' ? 'inherit' : settings.fontFamily,\r\n          'font-size': `${settings.fontSize}px`,\r\n          'font-weight': settings.fontWeight,\r\n          'line-height': settings.lineHeight,\r\n          transform: `scale(${settings.zoom / 100})`,\r\n          'transform-origin': 'top left',\r\n        },\r\n        'a, a:link, a:visited, a:hover, a:active': {\r\n          color: 'inherit !important',\r\n          '-webkit-text-fill-color': 'inherit !important',\r\n          'text-decoration': 'none',\r\n        },\r\n        '::selection': {\r\n          'background-color': 'rgba(0, 0, 255, 0.1)',\r\n          color: 'inherit',\r\n        },\r\n        '*': {\r\n          transition: 'none !important',\r\n        },\r\n      })\r\n\r\n      rendition.themes.select('default')\r\n\r\n      if (settings.pageView === 'double') {\r\n        rendition.spread('auto')\r\n      } else {\r\n        rendition.spread('none')\r\n      }\r\n\r\n      // Apply lại highlight sau khi settings đã được cập nhật\r\n      setTimeout(() => {\r\n        selections.forEach(note => {\r\n          rendition.annotations.add(\r\n            'highlight',\r\n            note.cfiRange,\r\n            {},\r\n            null,\r\n            'hl',\r\n            {\r\n              fill: note.color,\r\n              'fill-opacity': '0.3',\r\n              'mix-blend-mode': 'multiply',\r\n            },\r\n          )\r\n          activeHighlights.add(note.cfiRange)\r\n        })\r\n      }, 50)\r\n    }\r\n  }\r\n\r\n  const updateSettings = (key, value) => {\r\n    setSettings(prev => ({...prev, [key]: value}))\r\n\r\n    if (['fontSize', 'fontWeight', 'lineHeight', 'zoom'].includes(key)) {\r\n      rendition.clear()\r\n      rendition.themes.default({\r\n        body: {\r\n          background: settings.theme,\r\n          color: settings.theme === '#121212' ? '#FFFFFF' : '#000000',\r\n          'font-family': settings.fontFamily,\r\n          'font-size': `${value}px`,\r\n          'font-weight': key === 'fontWeight' ? value : settings.fontWeight,\r\n          'line-height': key === 'lineHeight' ? value : settings.lineHeight,\r\n          transform:\r\n            key === 'zoom'\r\n              ? `scale(${value / 100})`\r\n              : `scale(${settings.zoom / 100})`,\r\n          'transform-origin': 'top left',\r\n        },\r\n      })\r\n      rendition.display(loca)\r\n    }\r\n  }\r\n\r\n  const handleResetSettings = () => {\r\n    setSettings(defaultSettings)\r\n  }\r\n\r\n  // Event Listeners and Effect Hooks\r\n  useEffect(() => {\r\n    applySettings()\r\n  }, [settings])\r\n\r\n  useEffect(() => {\r\n    if (user?.userId && bookId) {\r\n      setLastReadingUpdate(Date.now())\r\n      setIsActive(true)\r\n\r\n      const intervalId = setInterval(() => {\r\n        if (isActive) {\r\n          updateReadingHistory()\r\n        }\r\n      }, 5 * 60 * 1000)\r\n\r\n      return () => {\r\n        updateReadingHistory()\r\n        clearInterval(intervalId)\r\n      }\r\n    }\r\n  }, [user, bookId])\r\n\r\n  useEffect(() => {\r\n    const handleVisibilityChange = () => {\r\n      if (document.hidden) {\r\n        setIsActive(false)\r\n        updateReadingHistory()\r\n      } else {\r\n        setIsActive(true)\r\n        setLastReadingUpdate(Date.now())\r\n      }\r\n    }\r\n\r\n    document.addEventListener('visibilitychange', handleVisibilityChange)\r\n    return () => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const epubUrl = `https://www.gutenberg.org/cache/epub/${bookId}/pg${bookId}.epub`\r\n    setEpubUrl(epubUrl)\r\n    getUser()\r\n  }, [bookId])\r\n\r\n  useEffect(() => {\r\n    const handleBeforeUnload = () => {\r\n      updateReadingHistory()\r\n    }\r\n\r\n    window.addEventListener('beforeunload', handleBeforeUnload)\r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload)\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    getBookmark()\r\n  }, [user])\r\n\r\n  useEffect(() => {\r\n    if (user && bookId) {\r\n      getNotes()\r\n    }\r\n  }, [user, bookId, rendition, isNote])\r\n\r\n  useEffect(() => {\r\n    if (rendition) {\r\n      const handleSelection = (cfiRange, contents) => {\r\n        const selection = contents.window.getSelection()\r\n        const text = selection.toString().trim() // Lấy text và trim luôn\r\n\r\n        // Chỉ xử lý khi có text thật sự\r\n        if (text) {\r\n          const range = selection.getRangeAt(0)\r\n          setSelectedText(text)\r\n          setSelectedCfiRange(cfiRange)\r\n\r\n          const rect = range.getBoundingClientRect()\r\n          const viewportHeight = window.innerHeight\r\n          const viewportWidth = window.innerWidth\r\n\r\n          setPopoverAnchor({\r\n            top:\r\n              rect.top < viewportHeight / 2\r\n                ? rect.bottom + window.scrollY + 115\r\n                : rect.top + window.scrollY - 60,\r\n            left: viewportWidth / 2 + 5,\r\n          })\r\n        }\r\n      }\r\n\r\n      rendition.on('selected', handleSelection)\r\n\r\n      rendition.themes.default({\r\n        '::selection': {\r\n          background: 'rgba(0, 0, 255, 0.1)',\r\n          color: 'inherit',\r\n        },\r\n        'a:link': {\r\n          color: 'inherit !important',\r\n          '-webkit-text-fill-color': 'inherit !important',\r\n        },\r\n        'a:hover': {\r\n          color: 'inherit !important',\r\n          '-webkit-text-fill-color': 'inherit !important',\r\n        },\r\n      })\r\n\r\n      return () => {\r\n        rendition.off('selected', handleSelection)\r\n      }\r\n    }\r\n  }, [rendition])\r\n\r\n  // Highlight Management\r\n  useEffect(() => {\r\n    if (rendition) {\r\n      const applyHighlight = note => {\r\n        if (!activeHighlights.has(note.cfiRange)) {\r\n          rendition.annotations.add(\r\n            'highlight',\r\n            note.cfiRange,\r\n            {},\r\n            null,\r\n            'hl',\r\n            {\r\n              fill: note.color,\r\n              'fill-opacity': '0.3',\r\n              'mix-blend-mode': 'multiply',\r\n              'white-space': 'pre-wrap', // Giữ nguyên khoảng trắng\r\n              'box-decoration-break': 'clone', // Đảm bảo highlight không vượt quá text\r\n            },\r\n          )\r\n          activeHighlights.add(note.cfiRange)\r\n        }\r\n      }\r\n\r\n      const removeHighlight = cfiRange => {\r\n        rendition.annotations.remove(cfiRange, 'highlight')\r\n        activeHighlights.delete(cfiRange)\r\n      }\r\n\r\n      const refreshHighlights = () => {\r\n        // Xóa những highlight không còn trong selections\r\n        for (const cfiRange of activeHighlights) {\r\n          if (!selections.some(note => note.cfiRange === cfiRange)) {\r\n            removeHighlight(cfiRange)\r\n          }\r\n        }\r\n\r\n        // Thêm những highlight mới\r\n        selections.forEach(note => {\r\n          if (!activeHighlights.has(note.cfiRange)) {\r\n            applyHighlight(note)\r\n          }\r\n        })\r\n      }\r\n\r\n      refreshHighlights()\r\n\r\n      // Handler cho việc di chuyển trang\r\n      const handleRelocated = () => {\r\n        selections.forEach(note => {\r\n          if (!activeHighlights.has(note.cfiRange)) {\r\n            applyHighlight(note)\r\n          }\r\n        })\r\n      }\r\n\r\n      rendition.on('relocated', handleRelocated)\r\n\r\n      return () => {\r\n        rendition.off('relocated', handleRelocated)\r\n        // Không xóa highlights khi unmount để tránh việc phải render lại\r\n      }\r\n    }\r\n  }, [rendition, selections])\r\n\r\n  const handleSave = async () => {\r\n    if (comment && selectedCfiRange) {\r\n      const newNote = {\r\n        userId: user.userId,\r\n        bookId: bookId,\r\n        content: comment,\r\n        selectedText: selectedText,\r\n        cfiRange: selectedCfiRange,\r\n        color: highlightColor,\r\n      }\r\n\r\n      try {\r\n        const response = await axios.post(\r\n          'http://localhost:8080/api/v1/note',\r\n          newNote,\r\n          {\r\n            headers: {\r\n              'Content-Type': 'application/json',\r\n              Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n            },\r\n          },\r\n        )\r\n\r\n        const createdNote = response.data\r\n        setSelections(prev => [...prev, createdNote])\r\n        setPopoverAnchor(null)\r\n        setComment('')\r\n        setSelectedText('')\r\n        setSelectedCfiRange('')\r\n        setIsNote(!isNote)\r\n      } catch (error) {\r\n        console.error('Error creating note:', error)\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleRemoveHighlight = async (cfiRange, noteId) => {\r\n    try {\r\n      await axios.delete(`http://localhost:8080/api/v1/note/${noteId}`, {\r\n        headers: {\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n      })\r\n\r\n      // Xóa highlight cụ thể\r\n      rendition.annotations.remove(cfiRange, 'highlight')\r\n      activeHighlights.delete(cfiRange)\r\n\r\n      // Cập nhật state\r\n      setSelections(selections.filter(s => s.cfiRange !== cfiRange))\r\n    } catch (error) {\r\n      console.error('Error deleting note:', error)\r\n    }\r\n  }\r\n\r\n  const filteredSelections = Array.isArray(selections)\r\n    ? selections\r\n        .filter(selection => {\r\n          const isTextMatch =\r\n            (selection.selectedText\r\n              ?.toLowerCase()\r\n              .includes(searchTerm.toLowerCase()) ??\r\n              false) ||\r\n            (selection.content\r\n              ?.toLowerCase()\r\n              .includes(searchTerm.toLowerCase()) ??\r\n              false)\r\n          const isColorMatch = filter === 'all' || selection.color === filter\r\n          return isTextMatch && isColorMatch\r\n        })\r\n        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))\r\n    : []\r\n\r\n  const readerStyles = {\r\n    ...ReactReaderStyle,\r\n    readerArea: {\r\n      ...ReactReaderStyle.readerArea,\r\n      backgroundColor: settings.theme,\r\n      color: settings.theme === '#121212' ? '#FFFFFF' : '#000000',\r\n    },\r\n  }\r\n\r\n  return (\r\n    <div\r\n      className='App'\r\n      style={{height: '100vh', display: 'flex', flexDirection: 'column'}}>\r\n      <ReaderHeader\r\n        title={bookTitle}\r\n        onBack={() => navigate(-1)}\r\n        onToggleNotes={handleToggleDrawer}\r\n        onToggleSettings={handleSettingsDrawerToggle}\r\n        user={user}\r\n        onToggleBookmark={handleToggleBookmark}\r\n        hasBookmark={hasBookmark}\r\n        currentLocation={currentLocation}\r\n      />\r\n\r\n      {loading && <p>Loading...</p>}\r\n      {error && <p style={{color: 'red'}}>{error}</p>}\r\n\r\n      <ReaderContent\r\n        epubUrl={epubUrl}\r\n        location={loca}\r\n        onLocationChanged={loc => setLocation(loc)}\r\n        onGetRendition={_rendition => {\r\n          setRendition(_rendition)\r\n\r\n          // Apply default settings ngay khi rendition được tạo\r\n          _rendition.themes.default({\r\n            body: {\r\n              background: defaultSettings.theme,\r\n              color:\r\n                defaultSettings.theme === '#121212' ? '#FFFFFF' : '#000000',\r\n              'font-family': defaultSettings.fontFamily,\r\n              'font-size': `${defaultSettings.fontSize}px`,\r\n              'font-weight': defaultSettings.fontWeight,\r\n              'line-height': defaultSettings.lineHeight,\r\n              transform: `scale(${defaultSettings.zoom / 100})`,\r\n              'transform-origin': 'top left',\r\n            },\r\n            'a, a:link, a:visited, a:hover, a:active': {\r\n              color: 'inherit !important',\r\n              '-webkit-text-fill-color': 'inherit !important',\r\n              'text-decoration': 'none',\r\n            },\r\n            '::selection': {\r\n              'background-color': 'rgba(0, 0, 255, 0.1)',\r\n              color: 'inherit',\r\n            },\r\n            '*': {\r\n              transition: 'none !important',\r\n            },\r\n          })\r\n\r\n          _rendition.themes.select('default')\r\n\r\n          if (defaultSettings.pageView === 'double') {\r\n            _rendition.spread('auto')\r\n          } else {\r\n            _rendition.spread('none')\r\n          }\r\n\r\n          _rendition.on('started', () => setLoading(false))\r\n        }}\r\n        onError={handleError}\r\n        readerStyles={readerStyles}\r\n      />\r\n      <NotePopover\r\n        anchorPosition={popoverAnchor}\r\n        open={Boolean(popoverAnchor)}\r\n        onClose={() => setPopoverAnchor(null)}\r\n        colors={colors}\r\n        highlightColor={highlightColor}\r\n        setHighlightColor={setHighlightColor}\r\n        comment={comment}\r\n        setComment={setComment}\r\n        onSave={handleSave}\r\n      />\r\n\r\n      <NotesDrawer\r\n        open={drawerOpen}\r\n        onClose={handleToggleDrawer}\r\n        searchTerm={searchTerm}\r\n        setSearchTerm={setSearchTerm}\r\n        filter={filter}\r\n        setFilter={setFilter}\r\n        colors={colors}\r\n        filteredSelections={filteredSelections}\r\n        rendition={rendition}\r\n        onRemoveHighlight={handleRemoveHighlight}\r\n        onEditNote={handleEditNote}\r\n      />\r\n\r\n      <Dialog open={Boolean(editingNote)} onClose={() => setEditingNote(null)}>\r\n        <DialogTitle>Edit Note</DialogTitle>\r\n        <DialogContent>\r\n          <TextField\r\n            autoFocus\r\n            margin='dense'\r\n            label='Comment'\r\n            fullWidth\r\n            multiline\r\n            rows={4}\r\n            value={editingNote?.content || ''}\r\n            onChange={e =>\r\n              setEditingNote({...editingNote, content: e.target.value})\r\n            }\r\n          />\r\n          <Select\r\n            value={editingNote?.color || colors[0]}\r\n            onChange={e =>\r\n              setEditingNote({...editingNote, color: e.target.value})\r\n            }\r\n            fullWidth\r\n            style={{marginTop: '10px'}}>\r\n            {colors.map((color, index) => (\r\n              <MenuItem key={index} value={color}>\r\n                <span\r\n                  style={{\r\n                    backgroundColor: color,\r\n                    padding: '2px 10px',\r\n                    borderRadius: '5px',\r\n                    color: color,\r\n                  }}>\r\n                  {`ColorColorColorColorColorColori`}\r\n                </span>\r\n              </MenuItem>\r\n            ))}\r\n          </Select>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setEditingNote(null)}>Cancel</Button>\r\n          <Button onClick={handleSaveEdit}>Save</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n\r\n      <SettingsDrawer\r\n        open={settingsDrawerOpen}\r\n        onClose={handleSettingsDrawerToggle}\r\n        settings={settings}\r\n        updateSettings={updateSettings}\r\n        themes={themes}\r\n        fontFamilies={fontFamilies}\r\n        onResetSettings={handleResetSettings}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ReadBookScreen\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}