{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from 'react';\nimport { getToken } from 'firebase/messaging';\nimport { messaging } from '../config/firebase';\nconst useFCM = () => {\n  _s();\n  const [fcmToken, setFcmToken] = useState(localStorage.getItem('fcmToken'));\n  useEffect(() => {\n    const initializeFCM = async () => {\n      try {\n        // Kiểm tra token đã tồn tại và chưa hết hạn\n        if (!fcmToken) {\n          const permission = await Notification.requestPermission();\n          if (permission === 'granted') {\n            const token = await getToken(messaging, {\n              vapidKey: process.env.REACT_APP_FIREBASE_VAPID_KEY\n            });\n            if (token) {\n              const response = await fetch(`${process.env.REACT_APP_API_BASE_URL}/notifications/register-device`, {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Authorization': `Bearer ${localStorage.getItem('token')}`\n                },\n                body: JSON.stringify({\n                  fcmToken: token\n                })\n              });\n              if (response.ok) {\n                localStorage.setItem('fcmToken', token);\n                setFcmToken(token);\n              }\n            }\n          }\n        }\n      } catch (error) {\n        console.error('FCM initialization error:', error);\n      }\n    };\n\n    // Chỉ khởi tạo khi người dùng đã đăng nhập\n    if (localStorage.getItem('token')) {\n      initializeFCM();\n    }\n  }, [fcmToken]);\n  return fcmToken;\n};\n_s(useFCM, \"pkeRxioHF+F9PXPgZZZYyoOgIFQ=\");\nexport default useFCM;","map":{"version":3,"names":["useEffect","useState","getToken","messaging","useFCM","_s","fcmToken","setFcmToken","localStorage","getItem","initializeFCM","permission","Notification","requestPermission","token","vapidKey","process","env","REACT_APP_FIREBASE_VAPID_KEY","response","fetch","REACT_APP_API_BASE_URL","method","headers","body","JSON","stringify","ok","setItem","error","console"],"sources":["C:/Users/TTC/OneDrive/Documents/GITHUB/fe-readhub/src/hooks/useFCM.js"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { getToken } from 'firebase/messaging';\r\nimport { messaging } from '../config/firebase';\r\n\r\nconst useFCM = () => {\r\n  const [fcmToken, setFcmToken] = useState(localStorage.getItem('fcmToken'));\r\n\r\n  useEffect(() => {\r\n    const initializeFCM = async () => {\r\n      try {\r\n        // Kiểm tra token đã tồn tại và chưa hết hạn\r\n        if (!fcmToken) {\r\n          const permission = await Notification.requestPermission();\r\n          if (permission === 'granted') {\r\n            const token = await getToken(messaging, {\r\n              vapidKey: process.env.REACT_APP_FIREBASE_VAPID_KEY\r\n            });\r\n\r\n            if (token) {\r\n              const response = await fetch(`${process.env.REACT_APP_API_BASE_URL}/notifications/register-device`, {\r\n                method: 'POST',\r\n                headers: {\r\n                  'Content-Type': 'application/json',\r\n                  'Authorization': `Bearer ${localStorage.getItem('token')}`\r\n                },\r\n                body: JSON.stringify({ fcmToken: token })\r\n              });\r\n\r\n              if (response.ok) {\r\n                localStorage.setItem('fcmToken', token);\r\n                setFcmToken(token);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('FCM initialization error:', error);\r\n      }\r\n    };\r\n\r\n    // Chỉ khởi tạo khi người dùng đã đăng nhập\r\n    if (localStorage.getItem('token')) {\r\n      initializeFCM();\r\n    }\r\n  }, [fcmToken]);\r\n\r\n  return fcmToken;\r\n};\r\n\r\nexport default useFCM;"],"mappings":";AAAA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,SAASC,QAAQ,QAAQ,oBAAoB;AAC7C,SAASC,SAAS,QAAQ,oBAAoB;AAE9C,MAAMC,MAAM,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnB,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGN,QAAQ,CAACO,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,CAAC;EAE1ET,SAAS,CAAC,MAAM;IACd,MAAMU,aAAa,GAAG,MAAAA,CAAA,KAAY;MAChC,IAAI;QACF;QACA,IAAI,CAACJ,QAAQ,EAAE;UACb,MAAMK,UAAU,GAAG,MAAMC,YAAY,CAACC,iBAAiB,CAAC,CAAC;UACzD,IAAIF,UAAU,KAAK,SAAS,EAAE;YAC5B,MAAMG,KAAK,GAAG,MAAMZ,QAAQ,CAACC,SAAS,EAAE;cACtCY,QAAQ,EAAEC,OAAO,CAACC,GAAG,CAACC;YACxB,CAAC,CAAC;YAEF,IAAIJ,KAAK,EAAE;cACT,MAAMK,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGJ,OAAO,CAACC,GAAG,CAACI,sBAAsB,gCAAgC,EAAE;gBAClGC,MAAM,EAAE,MAAM;gBACdC,OAAO,EAAE;kBACP,cAAc,EAAE,kBAAkB;kBAClC,eAAe,EAAE,UAAUf,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;gBAC1D,CAAC;gBACDe,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;kBAAEpB,QAAQ,EAAEQ;gBAAM,CAAC;cAC1C,CAAC,CAAC;cAEF,IAAIK,QAAQ,CAACQ,EAAE,EAAE;gBACfnB,YAAY,CAACoB,OAAO,CAAC,UAAU,EAAEd,KAAK,CAAC;gBACvCP,WAAW,CAACO,KAAK,CAAC;cACpB;YACF;UACF;QACF;MACF,CAAC,CAAC,OAAOe,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,EAAEA,KAAK,CAAC;MACnD;IACF,CAAC;;IAED;IACA,IAAIrB,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,EAAE;MACjCC,aAAa,CAAC,CAAC;IACjB;EACF,CAAC,EAAE,CAACJ,QAAQ,CAAC,CAAC;EAEd,OAAOA,QAAQ;AACjB,CAAC;AAACD,EAAA,CA3CID,MAAM;AA6CZ,eAAeA,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}